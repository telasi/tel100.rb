<h1 class="page-header"><%= @title %></h1>

<ol class="breadcrumb">
  <li><%= link_to 'საწყისი', admin_home_url %></li>
  <li><%= link_to 'მომხმარებლები', admin_users_url %></li>
  <li class="active"><%= @title %></li>
</ol>

<%= viewer_for @user do |v|
  v.button_action admin_edit_user_url(id:@user.id), icon: 'pencil', label: 'შეცვლა'
  v.button_action admin_delete_user_url(id:@user.id), icon: 'trash', label: 'წაშლა', http_method: 'delete', confirm: 'ნამდვილად გინდათ წაშლა?'
  v.button_action admin_generate_user_relations_url(@user), icon: 'magic', label: 'კავშირების გენერაცია', http_method: 'post', confirm: 'ნამდვილად გინდათ დაკავშირებული მომხმარებლების სიის გენერაცია?'
  v.required_text_field 'username', tag: 'code'
  v.required_text_field 'full_name'
  v.email_field 'email'
  v.text_field 'mobile_formatted', i18n: 'mobile'
  v.text_field 'phone'
  v.required_boolean_field 'active?', i18n: 'is_active'
  v.required_boolean_field 'admin?', i18n: 'is_admin'
  v.complex_field 'employee' do |c|
    c.text_field 'person_number', tag: 'code'
    c.text_field 'full_name', url: ->(x){ admin_employee_url(id: x.id) }
  end
end %>

<div class="page-header">
  <div class="pull-right">
    <%= link_to '<i class="fa fa-plus"></i> ახალი კავშირი'.html_safe,
      admin_relate_user_url(id:@user.id),
      class: ['btn', 'btn-default'] %>
  </div>
  <h3>
    დაქვემდებარება
    <code><%= @user.relations.count %></code>
  </h3>
</div>
<% if @user.relations.any? %>
    <table class="table table-bordered">
    <% @user.relations.each do |rel|
        user = rel.related %>
      <tr>
        <td width="150"><code><%= user.username %></code></td>
        <td width="150"><code><%= rel.role %></code></td>
        <td><%= link_to user.full_name, admin_user_url(user) %></td>
      </tr>
    <% end %>
  </table>
<% end %>