/*
 * File: app/view/document/editor/EditorViewModel.js
 *
 * This file was generated by Sencha Architect version 3.2.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 5.0.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 5.0.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('Tel100.view.document.editor.EditorViewModel', {
  extend: 'Ext.app.ViewModel',
  alias: 'viewmodel.documenteditoreditor',

  requires: [
    'Ext.app.bind.Formula'
  ],

  data: {
    document: null
  },

  formulas: {
    hideSignButton: function(get) {
      return get('document.as_signee') !== 1;
    },
    hideAuthorButton: function(get) {
      return get('document.as_author') !== 1;
    },
    authors: function(get) {
      var authors = get('document.authors');
      var text = [];
      if (authors.length) {
        for(var i = 0; i < authors.length; i++) {
          var author = authors[i];
          var decor = helpers.document.status.statusDecoration(author.status);
          text.push([
          '<span class="' + decor.style + '">',
          '<i class="fa ' + decor.icon + '"></i> ',
          '<a data-id="' + author.author_id + '" data-class="' + author.author_type + '">' + author.name + '</a>',
          ( author.response ? ' &mdash; ' + author.response : '' ),
          '</span>'
          ].join(''));
        }
        return text.join('; ');
      } else {
        var status = get('document.status');
        var decor = helpers.document.status.statusDecoration(status);
        var senderName = get('document.sender_name');
        var senderId = get('document.sender_id');
        var senderType = get('document.sender_type');
        return [
        '<strong class="text-success">' + i18n.document.base.sender + '</strong> &mdash; ',
        '<span class="' + decor.style + '">',
        '<i class="fa ' + decor.icon + '"></i> ',
        '<a data-id="' + senderId + '" data-class="' + senderType + '">' + senderName + '</a>',
        '</span>'
        ].join('');
      }
    },
    hideSignees: function(get) {
      var signees = get('document.signees');
      return !signees || signees.length === 0;
    },
    signees: function(get) {
      var signees = get('document.signees');
      var text = [];
      for(var i = 0; i < signees.length; i++) {
        var signee = signees[i];
        var decor = helpers.document.status.statusDecoration(signee.status);
        text.push([
        '<span class="' + decor.style + '">',
        '<i class="fa ' + decor.icon + '"></i> ',
        signee.name,
        ( signee.response ? ' &mdash; ' + signee.response : '' ),
        '</span> ',
        ( signee.completed_at ? '<span class="text-danger">' + signee.completed_at + '</span>' : '' )
        ].join(''));
      }
      return text.join('; ');
    },
    docinfo: function(get) {
      var docnumber = get('document.docnumber');
      var typeName = get('document.type.name');
      var status = get('document.status');
      var decor = helpers.document.status.statusDecoration(status);
      var senderName = get('document.sender_name');
      var sentAt = get('document.sent_at_f');
      return [
      '<span class="' + decor.style + '">',
      '<i class="fa ' + decor.icon + '"></i> ',
      '<strong>' + docnumber + '</strong>',
      '</span> ',
      '<span class="text-muted">' + typeName + '</span> &mdash; ',
      '<strong>' + senderName + '</strong>, ',
      '<span class="text-danger">' + sentAt + '</span>'
      ].join('');
    },
    incoming: function(get) {
      var incoming = get('document.incoming');
      var text = [];
      for (var i = 0; i < incoming.length; i++) {
        var from = incoming[i];
        var status = from.status;
        var decor = helpers.document.status.statusDecoration(status);
        var senderName = from.name;
        var currentStatus = from.current_status;
        if (from.sender_html) {
          var html = encodeURIComponent(from.sender_html);
        }
        text.push([
        '<span class="' + decor.style + '">',
        '<i class="fa ' + decor.icon + '"></i> ',
        '<a data-id="' + from.sender_id + '" data-class="' + from.sender_type + '">' + senderName + '</a>',
        ( currentStatus && currentStatus !== '--' ? ' &mdash; ' + currentStatus : ''  ),
        '</span>',
        ( from.completed_at ? ' <span class="text-danger">' + from.completed_at + '</span>' : '' )
        ].join(''));
      }
      return text.join('; ');
    },
    hideIncoming: function(get) {
      return !get('document.incoming').length;
    },
    outgoing: function(get) {
      var outgoing = get('document.outgoing');
      var text = [];
      for (var i = 0; i < outgoing.length; i++) {
        var to = outgoing[i];
        var status = to.status;
        var decor = helpers.document.status.statusDecoration(status);
        var icon;
        if (to.is_new) {
          icon = '<i class="fa fa-circle text-danger"></i> ';
        } else {
          icon = '<i class="fa ' + decor.icon + '"></i> ';
        }
        var receiverName = to.name;
        var currentStatus = to.current_status;
        if (to.receiver_html) {
          var html = encodeURIComponent(to.receiver_html);
        }
        text.push([
        '<span class="' + decor.style + '">', icon,
        '<a data-id="' + to.receiver_id + '" data-class="' + to.receiver_type + '">' + receiverName + '</a>',
        ( currentStatus && currentStatus !== '--' ? ' &mdash; ' + currentStatus : ''  ),
        '</span>',
        ( to.completed_at ? ' <span class="text-danger">' + to.completed_at + '</span>' : '' )
        ].join(''));
      }
      return text.join('; ');
    },
    hideOutgoing: function(get) {
      return !get('document.outgoing').length;
    }
  }

});