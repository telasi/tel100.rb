/*
 * File: app/view/document/comment/Panel.js
 *
 * This file was generated by Sencha Architect version 3.2.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 5.0.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 5.0.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('Tel100.view.document.comment.Panel', {
  extend: 'Ext.panel.Panel',
  alias: 'widget.documentcommentpanel',

  requires: [
    'Tel100.view.document.comment.PanelViewModel',
    'Tel100.view.document.comment.PanelViewController',
    'Ext.panel.Tool',
    'Ext.grid.Panel',
    'Ext.grid.column.Column',
    'Ext.grid.View'
  ],

  controller: 'documentcommentpanel',
  viewModel: {
    type: 'documentcommentpanel'
  },
  layout: 'fit',
  defaultListenerScope: true,

  bind: {
    title: '{i18n.document.comment.panelTitle} ({commentCount})'
  },
  tools: [
    {
      xtype: 'tool',
      type: 'refresh',
      listeners: {
        click: 'onToolClick'
      }
    }
  ],
  items: [
    {
      xtype: 'gridpanel',
      bind: {
        store: '{comments}'
      },
      columns: [
        {
          xtype: 'gridcolumn',
          renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
            var new_status = record.get('status');
            var old_status = record.get('old_status');
            if (new_status === old_status) {
              return '<i class="fa fa-comment text-muted"></i>';
            } else if (new_status > old_status) {
              return '<i class="fa fa-check"></i>';
            } else {
              return '<i class="fa fa-times"></i>';
            }
          },
          width: 32
        },
        {
          xtype: 'gridcolumn',
          width: 150,
          dataIndex: 'user',
          bind: {
            text: '{i18n.document.comment.author}'
          }
        },
        {
          xtype: 'gridcolumn',
          width: 200,
          dataIndex: 'text',
          bind: {
            text: '{i18n.document.comment.text}'
          }
        },
        {
          xtype: 'gridcolumn',
          width: 125,
          dataIndex: 'created_at',
          formatter: 'date("d/m/Y H:i")',
          bind: {
            text: '{i18n.document.comment.date}'
          }
        }
      ],
      viewConfig: {
        getRowClass: function(record, rowIndex, rowParams, store) {
          var new_status = record.get('status');
          var old_status = record.get('old_status');
          if (new_status === old_status) {
            return '';
          } else if (new_status > old_status) {
            return 'text-success';
          } else {
            return 'text-danger';
          }
        }
      }
    }
  ],

  onToolClick: function(tool, e, owner, eOpts) {
    this.refresh();
  },

  refresh: function(callback) {
    this.down('gridpanel').getStore().load({
      scope: this,
      callback: callback
    });
  },

  onStoreLoad: function(store, records, successful, eOpts) {
    var vm = this.getViewModel();
    vm.set('commentCount', store.count());
  }

});