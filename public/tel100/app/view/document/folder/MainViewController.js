/*
 * File: app/view/document/folder/MainViewController.js
 *
 * This file was generated by Sencha Architect version 3.1.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 5.0.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 5.0.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('Tel100.view.document.folder.MainViewController', {
  extend: 'Ext.app.ViewController',
  alias: 'controller.documentfoldermain',

  refreshDocuments: function(opts) {
    this.getView().up().down('documentgridpanel').refresh({params: opts});
  },

  onToolClick: function(tool, e, owner, eOpts) {
    var configwindow = Ext.create('Tel100.view.document.folder.Config');
    configwindow.show();
  },

  onstandardGridpanelSelect: function(rowmodel, record, index, eOpts) {
    this.refreshDocuments({folderType: 'standard', folderId: record.id});
    this.getView().down('#customFolders').getSelectionModel().deselectAll();
  },

  onGridpanelAfterRender: function(component, eOpts) {
    component.dropZone = Ext.create('Ext.dd.DropZone', component.el,{
      ddGroup: 'Grid2FolderDDGroup',

      getTargetFromEvent: function(e) {
        return e.getTarget('.foldercls');
      },

      onNodeEnter : function(target, dd, e, data){
        Ext.fly(target).highlight();
      },

      onNodeOver : function(target, dd, e, data){
        var proto = Ext.dd.DropZone.prototype;
        return proto.dropAllowed;
      },
      onNodeDrop : function(target, dd, e, data){
        var customGrid = Ext.ComponentQuery.query('grid[itemId=customFolders]')[0];
        var view = customGrid.getView();
        var record = view.getRecord(target);

        var vm = customGrid.up('panel').getViewModel();
        var model = Ext.create('Tel100.model.folder.Document',{
          folder_id: record.id, doc_id: data.records[0].id
        });
        model.save();

        return true;
      }
    });
  },

  onCustomFoldersSelect: function(rowmodel, record, index, eOpts) {
    this.refreshDocuments({folderType: 'custom', folderId: record.id});
    this.getView().down('#standardFolders').getSelectionModel().deselectAll();
  },

  onPanelBeforeRender: function(component, eOpts) {
    Ext.getStore('CustomFolders').load();
  }

});
