Ext.define("Tel100.model.Tel100",{extend:"Ext.data.schema.Schema",alias:"schema.tel100"}),Ext.define("Tel100.model.User",{extend:"Ext.data.Model",schema:"tel100",fields:[{name:"mobile"},{name:"phone"},{name:"first_name"},{name:"last_name"},{calculate:function(e){var t=e.mobile;return t&&9===t.length?"("+t.substr(0,3)+")"+t.substr(3,3)+"-"+t.substr(6,3):t},name:"formatted_mobile"},{calculate:function(e){var t=e.phone;return t&&4===t.length?t.substr(0,1)+"-"+t.substr(1):t&&3===t.length?"7-"+t:t},name:"formatted_phone"},{calculate:function(e){return e.first_name+" "+e.last_name},name:"full_name"}],proxy:{type:"rest",url:"/api/sys/users"}}),Ext.define("Tel100.store.CustomFolders",{extend:"Ext.data.Store",constructor:function(e){var t=this;e=e||{},t.callParent([Ext.apply({storeId:"customfolders",autoLoad:!1,model:"Tel100.model.folder.Base"},e)])}}),Ext.define("Tel100.view.Main",{extend:"Ext.container.Viewport",alias:"widget.main",controller:"main",viewModel:{type:"main"},itemId:"main-viewport",layout:{type:"card",deferredRender:!0},items:[{xtype:"container",layout:{type:"vbox",align:"center",pack:"center"},items:[{xtype:"userloginpanel",itemId:"login",listeners:{loggedin:"onLoggedin"}},{xtype:"workarealocaleselector",margin:8}]},{xtype:"workareapanel",itemId:"workarea"}],listeners:{beforerender:"onBeforeRender"}}),Ext.define("Tel100.view.MainViewController",{extend:"Ext.app.ViewController",alias:"controller.main",onLoggedin:function(e){var e=helpers.user.getCurrentUser();this.getViewModel().set("currentUser",e);var t=this.getView(),n=t.getLayout();n.setActiveItem("workarea")},onBeforeRender:function(e,t){var n=helpers.i18n.getCurrentLocale(),o=window[n];window.i18n=o;var i=this.getViewModel();i.set("i18n",o)}}),Ext.define("Tel100.view.MainViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.main"}),Ext.define("Tel100.model.bs.Customer",{extend:"Ext.data.Model",schema:"tel100",proxy:{type:"rest",extraParams:{name:""},url:"/api/bs/list",reader:{type:"json",rootProperty:"data"}},fields:[{name:"id"},{name:"name"},{name:"taxid"},{name:"address"},{name:"accnumb"}],toHtml:function(){return['<i class="fa fa-users"></i>',this.get("name")].join(" ")}}),Ext.define("Tel100.model.document.Base",{extend:"Ext.data.Model",uses:["Tel100.model.document.Type"],schema:"tel100",proxy:{type:"rest",url:"/api/documents/base"},fields:[{type:"date",name:"docdate"},{type:"date",name:"original_date"},{type:"date",name:"due_date"},{name:"my_status"},{name:"type",reference:"Tel100.model.document.Type"},{calculate:function(e){if(e.type){var t=e.type;if(t.name)return t.name;if(t.get)return t.get("name")}},name:"typeName"},{name:"my_role"},{calculate:function(e){return helpers.document.status.statusFormatted(e.my_status,e.my_role,{isMotion:!1,isNew:e.is_new,isChanged:e.is_changed})},name:"myStatusName"},{name:"is_new"},{name:"is_changed"},{calculate:function(e){return helpers.document.status.statusFormatted(e.status)},name:"statusName"},{name:"status"},{name:"direction"},{calculate:function(e){return i18n.document.base.directions[e.direction]},name:"directionName"}]}),Ext.define("Tel100.model.document.Comment",{extend:"Ext.data.Model",fields:[{type:"date",name:"created_at"}]}),Ext.define("Tel100.model.document.Direction",{extend:"Ext.data.Model",fields:[{name:"id"},{calculate:function(e){return i18n.document.base.directions[e.id]},name:"name"}]}),Ext.define("Tel100.model.document.File",{extend:"Ext.data.Model",fields:[{type:"date",name:"created_at"}]}),Ext.define("Tel100.model.document.Motion",{extend:"Ext.data.Model",fields:[{name:"receiver"},{name:"receiver_user"},{calculate:function(e){var t=e.receiver;return t?t.name||t.first_name+" "+t.last_name:void 0},name:"receiverName"},{name:"sender"},{name:"sender_user"},{calculate:function(e){var t=e.sender;return"string"==typeof t?t:t?t.name||t.first_name+" "+t.last_name:void 0},name:"senderName"},{type:"date",name:"due_date"},{type:"date",name:"created_at"},{type:"date",name:"sent_at"},{type:"date",name:"received_at"},{type:"date",name:"completed_at"},{type:"date",name:"updated_at"},{name:"status"},{calculate:function(e){return helpers.document.status.motionStatusFull(e.status,e)},name:"statusFull"}],proxy:{type:"rest",url:"/api/documents/motion"}}),Ext.define("Tel100.model.document.ResponseType",{extend:"Ext.data.Model"}),Ext.define("Tel100.model.document.Type",{extend:"Ext.data.Model",schema:"tel100",proxy:{type:"rest",url:"/api/documents/types"}}),Ext.define("Tel100.model.folder.Base",{extend:"Ext.data.Model",schema:"tel100",proxy:{type:"rest",url:"/api/folder"},fields:[{name:"name"},{name:"category"},{calculate:function(e){return!0},name:"custom"},{name:"folder_type"},{name:"form"}]}),Ext.define("Tel100.model.folder.Document",{extend:"Ext.data.Model",schema:"tel100",proxy:{type:"rest",url:"/api/folder/document",writer:{type:"json",writeAllFields:!0}},fields:[{name:"folder_id"},{name:"doc_id"}]}),Ext.define("Tel100.model.folder.Standard",{extend:"Ext.data.Model",schema:"tel100",proxy:{type:"rest",url:"/api/folder/standard"},fields:[{name:"name"},{name:"category"},{name:"id"},{name:"count"}]}),Ext.define("Tel100.model.hr.Employee",{extend:"Ext.data.TreeModel",entityName:"hr.Employee",fields:[{name:"user_id"},{name:"first_name"},{name:"last_name"},{calculate:function(e){return!!e.user_id},name:"has_user"},{calculate:function(e){return e.first_name+" "+e.last_name},name:"full_name"},{calculate:function(e){return e.first_name+" "+e.last_name},name:"name"},{name:"vacation"},{calculate:function(e){return!!e.vacation},name:"on_vacation"},{name:"vac_text"},{name:"sub_id"},{name:"sub_name"}],toHtml:function(){var e;return this.get("on_vacation")?helpers.party.vacationDecorations(this):(e=this.get("has_user")?'<span class="text-success"><i class="fa fa-user"></i></span>':'<span class="text-danger"><i class="fa fa-circle"></i></span>',[e,this.get("full_name")].join(" "))}}),Ext.define("Tel100.model.hr.Organization",{extend:"Ext.data.TreeModel",entityName:"hr.Organization",toHtml:function(){return['<span class="text-muted"><i class="fa fa-bank"></i></span>',this.get("name")].join(" ")}}),Ext.define("Tel100.model.hr.Party",{extend:"Ext.data.Model",schema:"tel100",proxy:{type:"rest",extraParams:{name:""},url:"/api/hr/party/list",reader:{type:"json",rootProperty:"data"}},fields:[{name:"id"},{name:"name_ka"},{name:"address_ka"},{name:"contact_ka"},{name:"identity"},{name:"phones"},{name:"email"},{name:"ext_type"}],toHtml:function(){return['<i class="fa fa-building"></i>',this.get("name_ka")].join(" ")}}),Ext.define("Tel100.model.party.Favourites",{extend:"Ext.data.Model",schema:"tel100",proxy:{type:"rest",url:"/api/party/favourites"},fields:[{name:"id"},{name:"person_id"},{name:"person_type"},{name:"name"},{calculate:function(e){return helpers.party.convertTypeToExt(e.person_type)},name:"ext_type"}],toHtml:function(){return this.get("name")}}),Ext.define("Tel100.view.admin.Panel",{extend:"Ext.panel.Panel",alias:"widget.adminpanel",controller:"adminpanel",viewModel:{type:"adminpanel"},layout:"border",items:[{xtype:"adminactionspanel",collapsible:!0,region:"west",split:!0,listeners:{actionselected:"onActionSelected"}},{xtype:"container",region:"center",itemId:"center-panel",layout:{type:"card",deferredRender:!0},items:[{xtype:"container",layout:{type:"hbox",align:"middle",pack:"center"},items:[{xtype:"label",bind:{text:"{i18n.admin.actions.selectAction}"}}]},{xtype:"admintypesadminpanel",itemId:"documents-types"},{xtype:"adminusersadminpanel",itemId:"sys-users"}]}]}),Ext.define("Tel100.view.admin.PanelViewController",{extend:"Ext.app.ViewController",alias:"controller.adminpanel",onActionSelected:function(e,t){var n=this.getView().down("#center-panel");n.setActiveItem(e+"-"+t)}}),Ext.define("Tel100.view.admin.PanelViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.adminpanel",data:{action:null}}),Ext.define("Tel100.view.document.Main",{extend:"Ext.panel.Panel",alias:"widget.documentmain",controller:"documentmain",viewModel:{type:"documentmain"},layout:"border",defaultListenerScope:!0,items:[{xtype:"documentfoldertab",width:250,collapsible:!0,region:"west",split:!0,listeners:{folderChosen:{fn:"onTabpanelFolderChosen",scope:"controller"},foldersrefresh:{fn:"onFoldersRefresh",scope:"controller"}}},{xtype:"tabpanel",region:"center",border:!1,itemId:"documentTabs",activeTab:0,items:[{xtype:"panel",dockedItems:[{xtype:"toolbar",dock:"top",items:[{handler:"onRefresh",bind:{text:"{i18n.document.base.ui.refresh}"}},{handler:"onNewDocument",cls:"success-button",bind:{text:"{i18n.document.base.ui.newDocument}"}},"->",{handler:"onDeleteDraft",cls:"danger-button",bind:{text:"{i18n.document.base.ui.deleteDraft}",disabled:"{deleteDraftButtonDisabled}"}}]}],border:!1,layout:"fit",bind:{title:"{i18n.document.base.ui.documents}"},items:[{xtype:"documentgridpanel",bind:{selection:"{selection}"},listeners:{documentopen:"onGridpanelDocumentopen",documentsign:"onGridpanelDocumentsign",documentauthor:"onGridpanelDocumentauthor"}}]}]}],listeners:{beforerender:"onPanelBeforeRender"},onGridpanelDocumentopen:function(e){this.getController().openDocument(e)},onGridpanelDocumentsign:function(e){var t=this,n=Ext.create("Tel100.view.document.comment.Sign",{modal:!0});n.getViewModel().set("document",e),n.on("signed",function(){t.onRefresh()}),n.show()},onGridpanelDocumentauthor:function(e){var t=this,n=Ext.create("Tel100.view.document.comment.Author",{modal:!0});n.getViewModel().set("document",e),n.on("authored",function(){t.onRefresh()}),n.show()},onPanelBeforeRender:function(e,t){var n=this,o=this.down("documentfoldersearch");o.on("searchstart",function(e,t){n.down("documentgridpanel").getController().setStoreConfig({url:e,extraParams:t}),n.down("documentgridpanel").refresh()})},onNewDocument:function(){this.getController().onNewDocument()},onRefresh:function(){this.getController().onRefresh(),this.down("documentfoldertab").fireEvent("documentgridrefresh")},onDeleteDraft:function(){this.getController().onDeleteDraft()}}),Ext.define("Tel100.view.document.MainViewController",{extend:"Ext.app.ViewController",alias:"controller.documentmain",onRefresh:function(e){e&&e.$className&&(e=null);var t=this.getView().down("documentgridpanel");t.refresh(e)},onDeleteDraft:function(){var e=this.getViewModel(),t=e.get("customfolderselection"),n=e.get("selection");if(t)this.deleteFromCustom(t[0].id,n.id),this.onRefresh();else if(n){var o=n.get("status");if(o===helpers.document.status.DRAFT){var i=i18n.document.base.ui.confirmDeleteDraft,d=i18n.ui.confirmTitle;Ext.Msg.confirm(d,i,function(e){"yes"===e&&helpers.api.document.base.deleteDraft(n.id,{success:this.onRefresh.bind(this)})}.bind(this))}}},onNewDocument:function(){helpers.api.document.base.createDraft({success:function(e){this.onRefresh();var t=Ext.create("Tel100.model.document.Base",e);this.getViewModel().set("selection",t),this.openDocument(t)}.bind(this)})},openDocument:function(e){for(var t=this.getView().down("#documentTabs"),n=t.items,o=0;o<n.length;o++){var i=n.getAt(o),d=i.getViewModel(),a=d&&d.get("document");if(a&&a.id===e.id)return void t.setActiveTab(i)}e.load({success:function(e){var n=e.get("status")===helpers.document.status.DRAFT;n?this.openDraftDocument(t,e):this.openCurrentDocument(t,e)}.bind(this)})},openDraftDocument:function(e,t){var n=i18n.document.base.ui.editDraftTitle,o=Tel100.view.document.editor.Creator.create({title:n,closable:!0});o.setDocument(t),o.on("documentsent",function(t){e.remove(o),this.onRefresh()}.bind(this)),e.add(o),e.setActiveTab(o)},openCurrentDocument:function(e,t){var n=t.get("docnumber"),o=Tel100.view.document.editor.Editor.create({title:n,closable:!0});o.getViewModel().set("document",t),e.add(o),e.setActiveTab(o)},deleteFromCustom:function(e,t){var n={};n.method="DELETE",n.url="/api/folder/document",n.params={folder_id:e,doc_id:t},Ext.Ajax.request(n)},onTabpanelFolderChosen:function(e){this.getView().getComponent("documentTabs").setActiveTab(0)},onFoldersRefresh:function(e){this.onRefresh()}}),Ext.define("Tel100.view.document.MainViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.documentmain",data:{selection:null,customfolderselection:null},formulas:{deleteDraftButtonDisabled:function(e){var t=e("selection");if(this.getData().customfolderselection)return!1;if(t){var n=t.get("status");return n!==helpers.document.status.DRAFT}return!0}}}),Ext.define("Tel100.view.document.Search",{extend:"Ext.window.Window",alias:"widget.documentsearch",viewModel:{type:"documentsearch"},height:400,width:800,layout:"border",closeAction:"hide",defaultListenerScope:!0,bind:{title:"{i18n.document.search.ui.search}"},items:[{xtype:"documentfoldersearch",width:300,title:"",titleCollapse:!1,region:"west",split:!0},{xtype:"documentgridpanel",region:"center",listeners:{itemdblclick:"onGridpanelItemDblClick"}}],onGridpanelItemDblClick:function(e,t,n,o,i,d){var a=this.getParentDocument();0!==t.get("status")&&t.id!==a.id&&(this.fireEvent("documentselected",t),this.close())},getParentDocument:function(){return this.getViewModel().get("document")},setParentDocument:function(e){this.getViewModel().set("document",e)}}),Ext.define("Tel100.view.document.SearchViewController",{extend:"Ext.app.ViewController",alias:"controller.documentsearch"}),Ext.define("Tel100.view.document.SearchViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.documentsearch"}),Ext.define("Tel100.view.modules.Admin",{extend:"Ext.container.Container",alias:"widget.modulesadmin",viewModel:{type:"modulesadmin"},layout:"fit",items:[{xtype:"adminpanel"}]}),Ext.define("Tel100.view.modules.AdminViewController",{extend:"Ext.app.ViewController",alias:"controller.modulesadmin"}),Ext.define("Tel100.view.modules.AdminViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.modulesadmin"}),Ext.define("Tel100.view.modules.Documents",{extend:"Ext.container.Container",alias:"widget.modulesdocuments",viewModel:{type:"modulesdocuments"},layout:"fit",items:[{xtype:"documentmain",border:!1}]}),Ext.define("Tel100.view.modules.DocumentsViewController",{extend:"Ext.app.ViewController",alias:"controller.modulesdocuments"}),Ext.define("Tel100.view.modules.DocumentsViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.modulesdocuments"}),Ext.define("Tel100.view.modules.HR",{extend:"Ext.container.Container",alias:"widget.moduleshr",controller:"moduleshr",viewModel:{type:"moduleshr"},items:[{xtype:"tabpanel",activeTab:0,items:[{xtype:"panel",bind:{title:"{i18n.vacation.ui.title}"},dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",bind:{text:"{i18n.vacation.ui.button}"},listeners:{click:"onButtonClick"}}]}],items:[{xtype:"gridpanel",title:"ისტორია",bind:{store:"{vacationlist}"},columns:[{xtype:"datecolumn",dataIndex:"from_date",flex:2,format:"d/m/Y",bind:{text:"{i18n.vacation.fields.from}"}},{xtype:"datecolumn",dataIndex:"to_date",flex:2,format:"d/m/Y",bind:{text:"{i18n.vacation.fields.to}"}},{xtype:"gridcolumn",dataIndex:"type_name",flex:10,bind:{text:"{i18n.vacation.fields.type}"}},{xtype:"gridcolumn",dataIndex:"full_name",flex:10,bind:{text:"{i18n.vacation.fields.substitude}"}}]}]},{xtype:"panel",title:"HR Structure",items:[{xtype:"hrtreepanel"}]}]}]}),Ext.define("Tel100.view.modules.HRViewController",{extend:"Ext.app.ViewController",alias:"controller.moduleshr",onButtonClick:function(e,t,n){var o=Ext.create("Tel100.view.hr.vacation.Window");o.show()}}),Ext.define("Tel100.view.modules.HRViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.moduleshr",stores:{vacationlist:{autoLoad:!0,proxy:{type:"rest",url:"/api/vacation/list"},fields:[{name:"id"},{name:"from_date"},{name:"to_date"},{name:"full_name"},{name:"type_name"}]}}}),Ext.define("Tel100.view.party.Favourites",{extend:"Ext.grid.Panel",alias:"widget.partyfavourites",controller:"partyfavourites",viewModel:{type:"partyfavourites"},defaultListenerScope:!0,bind:{title:"{i18n.hr.favourites.title}",store:"{favourites}"},columns:[{xtype:"gridcolumn",renderer:function(e,t,n,o,i,d,a){return helpers.party.favouriteDecoration(e,n)},draggable:!1,resizable:!1,dataIndex:"name",hideable:!1,flex:1,bind:{text:"{i18n.hr.party.fields.name}"}}],listeners:{afterrender:"onGridpanelAfterRender"},onGridpanelAfterRender:function(e,t){e.addDocked(new Ext.PagingToolbar({displayInfo:!0,dock:"bottom",afterPageText:" / {0}",beforePageText:i18n.ui.page,emptyMsg:i18n.ui.emptyMsg,displayMsg:i18n.ui.displayMsg,bind:{store:"{favourites}"}}))},onStoreBeforeLoad:function(e,t,n){var o=this.up("partyselector"),i=o.getViewModel(),d=e.getProxy();d.setExtraParams({hideHR:i.get("hideHR"),hideParty:i.get("hideParty"),hideCustomers:i.get("hideCustomers")})}}),Ext.define("Tel100.view.party.FavouritesViewController",{extend:"Ext.app.ViewController",alias:"controller.partyfavourites",onStoreBeforeLoad:function(e,t,n){}}),Ext.define("Tel100.view.party.FavouritesViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.partyfavourites",stores:{favourites:{autoLoad:!0,model:"Tel100.model.party.Favourites",listeners:{beforeload:"onStoreBeforeLoad"}}}}),Ext.define("Tel100.view.party.Selector",{extend:"Ext.window.Window",alias:"widget.partyselector",controller:"partyselector",viewModel:{type:"partyselector"},height:500,width:950,autoDestroy:!1,closeAction:"hide",title:"Select Party",maximizable:!0,modal:!0,defaultListenerScope:!0,layout:{type:"hbox",align:"stretch"},items:[{xtype:"tabpanel",flex:1,activeTab:1,items:[{xtype:"partyfavourites",listeners:{beforeitemcontextmenu:{fn:"onFavouritesBeforeItemContextMenu",scope:"controller"},celldblclick:"onFavouritesCellDblClick"}},{xtype:"hrtreepanel",cls:"panel-with-border",listeners:{celldblclick:"onHRTreeDblClick",beforeitemcontextmenu:{fn:"onHRStructureBeforeItemContextMenu",scope:"controller"}},tabConfig:{xtype:"tab",bind:{hidden:"{hideHR}"}}},{xtype:"hrpartygrid",tabConfig:{xtype:"tab",bind:{hidden:"{hideParty}"}},listeners:{itemdblclick:"onPartyGridpanelItemDblClick",beforeitemcontextmenu:{fn:"onPartiesBeforeItemContextMenu",scope:"controller"}}},{xtype:"bscustomerpanel",tabConfig:{xtype:"tab",bind:{hidden:"{hideCustomers}"}},listeners:{itemdblclick:"onCustomerGridpanelItemDblClick",beforeitemcontextmenu:{fn:"onCustomerBeforeItemContextMenu",scope:"controller"}}}]},{xtype:"splitter",width:5},{xtype:"gridpanel",cls:"panel-with-border",itemId:"selectedParties",width:300,bodyBorder:!0,hideHeaders:!0,bind:{title:"{i18n.selector.selectedParties}",store:"{parties}"},columns:[{xtype:"gridcolumn",renderer:function(e,t,n,o,i,d,a){return n.toHtml?n.toHtml():void 0},dataIndex:"name",text:"Name",flex:1}],listeners:{celldblclick:"onSelectedPartiesCellDblClick"},tools:[{xtype:"tool",type:"minus",listeners:{click:"onRemoveToolClick"}}]}],dockedItems:[{xtype:"toolbar",flex:1,dock:"bottom",items:[{xtype:"button",bind:{text:"{i18n.ui.cancel}"},listeners:{click:"onCancelClick"}},{xtype:"tbspacer",flex:1},{xtype:"button",bind:{text:"{i18n.selector.selectorConfirm}"},listeners:{click:"onSelectClicked"}}]}],onFavouritesCellDblClick:function(e,t,n,o,i,d,a,r){this.getController().addFromFavourites(o)},onHRTreeDblClick:function(e,t,n,o,i,d,a,r){this.getController().onAddParty(o)},onPartyGridpanelItemDblClick:function(e,t,n,o,i,d){"hr.Party"===t.get("ext_type")&&this.getController().onAddParty(t)},onCustomerGridpanelItemDblClick:function(e,t,n,o,i,d){"bs.Customer"===t.get("ext_type")&&this.getController().onAddParty(t)},onCancelClick:function(e,t,n){this.close()},onSelectClicked:function(e,t,n){var o=[],i=this.down("#selectedParties"),d=i.getStore();d.each(function(e){o.push(e)}),this.fireEvent("selectioncomplete",o),d.removeAll(),this.close()},onSelectedPartiesCellDblClick:function(e,t,n,o,i,d,a,r){this.getController().onRemoveParty(o)},onRemoveToolClick:function(e,t,n,o){var i=this.down("#selectedParties"),d=i.getSelection();d.length>0&&this.getController().onRemoveParty(d[0])}}),Ext.define("Tel100.view.party.SelectorViewController",{extend:"Ext.app.ViewController",alias:"controller.partyselector",onAddParty:function(e){var t=this.getView().getComponent("selectedParties");t.getStore().add(e)},onRemoveParty:function(e){var t=this.getView().getComponent("selectedParties"),n=t.getStore();n.remove(e)},contextMenu:function(e,t,n,o,i){var d=Ext.create("Ext.menu.Menu",{items:[{text:i18n.hr.favourites.add_to,icon:"/images/add.png",handler:function(e){var n=Ext.create("Tel100.model.party.Favourites",{person_id:t.id,person_type:t.get("ext_type")});n.save();var o=Ext.ComponentQuery.query("partyfavourites")[0],i=o.store;i.reload()}}]});i.stopEvent(),d.showAt(i.getXY())},addFromFavourites:function(e){var t=Ext.create("Tel100.model.party.Favourites",{id:e.get("person_id"),name:e.get("name"),person_type:e.get("person_type")});this.onAddParty(t)},onFavouritesBeforeItemContextMenu:function(e,t,n,o,i,d){var a=Ext.create("Ext.menu.Menu",{items:[{text:i18n.hr.favourites["delete"],icon:"/images/delete.png",handler:function(e){var t=Ext.ComponentQuery.query("partyfavourites")[0],n=t.store,o=t.selection;o&&Ext.Msg.show({title:i18n.ui.destroy,message:i18n.ui.destroyConfirm,buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(e){"yes"===e&&(n.remove(o),n.sync(),n.reload())}})}}]});i.stopEvent(),a.showAt(i.getXY())},onHRStructureBeforeItemContextMenu:function(e,t,n,o,i,d){"hr.Employee"==t.get("ext_type")&&this.contextMenu(e,t,n,o,i)},onPartiesBeforeItemContextMenu:function(e,t,n,o,i,d){this.contextMenu(e,t,n,o,i)},onCustomerBeforeItemContextMenu:function(e,t,n,o,i,d){this.contextMenu(e,t,n,o,i)}}),Ext.define("Tel100.view.party.SelectorViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.partyselector",stores:{parties:{}}}),Ext.define("Tel100.view.workarea.LocaleSelector",{extend:"Ext.button.Segmented",alias:"widget.workarealocaleselector",controller:"workarealocaleselector",viewModel:{type:"workarealocaleselector"},items:[{itemId:"i18nka",text:"ქართული"},{itemId:"i18nru",text:"Русский"}],listeners:{afterrender:"onSegmentedbuttonAfterRender",toggle:"onSegmentedbuttonToggle"}}),Ext.define("Tel100.view.workarea.LocaleSelectorViewController",{extend:"Ext.app.ViewController",alias:"controller.workarealocaleselector",onSegmentedbuttonAfterRender:function(e,t){var n="#i18n"+helpers.i18n.getCurrentLocale();this.getView().down(n).toggle()},onSegmentedbuttonToggle:function(e,t,n,o){var i=(t.getItemId(),t.getItemId().substr(4)),d=helpers.i18n.getCurrentLocale();if(i!=d){helpers.i18n.setCurrentLocale(i);var a=window[i];this.getView().up("#main-viewport").getViewModel().set("i18n",a),window.i18n=a}}}),Ext.define("Tel100.view.workarea.LocaleSelectorViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.workarealocaleselector"}),Ext.define("Tel100.view.workarea.Panel",{extend:"Ext.panel.Panel",alias:"widget.workareapanel",controller:"workareapanel",viewModel:{type:"workareapanel"},border:!1,layout:"border",items:[{xtype:"container",region:"north",padding:4,layout:{type:"hbox",align:"stretch"},items:[{xtype:"segmentedbutton",items:[{itemId:"docs",text:"docs"},{itemId:"hr",text:"hr"},{itemId:"admin",text:"admin"}],listeners:{toggle:"onToggle"}},{xtype:"tbspacer",flex:1},{xtype:"userboxbutton"}]},{xtype:"container",region:"center",itemId:"body-layout",layout:{type:"card",deferredRender:!0},items:[{xtype:"modulesdocuments",border:0,itemId:"docs"},{xtype:"moduleshr",itemId:"hr"},{xtype:"modulesadmin",itemId:"admin"}]}],listeners:{beforerender:"onBeforeRender"}}),Ext.define("Tel100.view.workarea.PanelViewController",{extend:"Ext.app.ViewController",alias:"controller.workareapanel",setCurrentApplication:function(e,t){if(t&&t.toggleButton){var n=this.getView().down("#"+e);n.toggle()}if(t&&t.switchApplication){var o=this.getView().down("#body-layout");o.setActiveItem(e)}helpers.preferences.setValue("current-application",e)},onToggle:function(e,t,n,o){this.setCurrentApplication(t.itemId,{switchApplication:!0})},onBeforeRender:function(e,t){var n=helpers.preferences.getValue("current-application","docs");this.setCurrentApplication(n,{toggleButton:!0,switchApplication:!0})}}),Ext.define("Tel100.view.workarea.PanelViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.workareapanel"}),Ext.define("Tel100.model.hr.vacation.Type",{extend:"Ext.data.Model",schema:"tel100",proxy:{type:"rest",url:"/api/vacation/types"}}),Ext.define("Tel100.model.hr.vacation.Vacation",{extend:"Ext.data.Model",schema:"tel100",proxy:{type:"rest",url:"/api/vacation"}}),Ext.define("Tel100.view.admin.actions.Panel",{extend:"Ext.grid.Panel",alias:"widget.adminactionspanel",controller:"adminactionspanel",viewModel:{type:"adminactionspanel"},width:200,hideHeaders:!0,bind:{title:"{i18n.admin.actions.title}",store:"{actions}"},columns:[{xtype:"gridcolumn",renderer:function(e,t,n,o,i,d,a){var r=n.get("category"),l=n.get("name");return i18n.admin[r][l]},dataIndex:"name",text:"String",flex:1}],features:[{ftype:"grouping",groupByText:"category",groupHeaderTpl:Ext.create("Ext.XTemplate","{name:this.categoryName}",{categoryName:function(e){return i18n.admin[e].title}})}],listeners:{selectionchange:"onActionChange"}}),Ext.define("Tel100.view.admin.actions.PanelViewController",{extend:"Ext.app.ViewController",alias:"controller.adminactionspanel",onActionChange:function(e,t,n){var o=t[0];if(o){var i=o.get("category"),d=o.get("name");this.getView().fireEvent("actionselected",i,d)}}}),Ext.define("Tel100.view.admin.actions.PanelViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.adminactionspanel",stores:{actions:{groupField:"category",data:[{category:"documents",name:"types"},{category:"sys",name:"users"}],fields:[{name:"name"},{name:"category"}]}}}),Ext.define("Tel100.view.admin.types.AdminPanel",{extend:"Ext.panel.Panel",alias:"widget.admintypesadminpanel",viewModel:{type:"admintypesadminpanel"},layout:"border",items:[{xtype:"admintypesgridpanel",region:"west",split:!0}]}),Ext.define("Tel100.view.admin.types.AdminPanelViewController",{extend:"Ext.app.ViewController",alias:"controller.admintypesadminpanel"}),Ext.define("Tel100.view.admin.types.AdminPanelViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.admintypesadminpanel"}),Ext.define("Tel100.view.admin.users.AdminPanel",{extend:"Ext.panel.Panel",alias:"widget.adminusersadminpanel",viewModel:{type:"adminusersadminpanel"},title:"users"}),Ext.define("Tel100.view.admin.users.AdminPanelViewController",{extend:"Ext.app.ViewController",alias:"controller.adminusersadminpanel"}),Ext.define("Tel100.view.admin.users.AdminPanelViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.adminusersadminpanel"}),Ext.define("Tel100.view.bs.customer.Panel",{extend:"Ext.grid.Panel",alias:"widget.bscustomerpanel",controller:"bscustomerpanel",viewModel:{type:"bscustomerpanel"},defaultListenerScope:!0,bind:{title:"{i18n.hr.customer.title}",store:"{customer}"},columns:[{xtype:"gridcolumn",dataIndex:"name",flex:3,bind:{text:"{i18n.hr.party.fields.name}"}},{xtype:"gridcolumn",dataIndex:"address",flex:3,bind:{text:"{i18n.hr.party.fields.address}"}},{xtype:"gridcolumn",dataIndex:"taxid",flex:1,bind:{text:"{i18n.hr.party.fields.identity}"}},{xtype:"gridcolumn",dataIndex:"accnumb",bind:{text:"{i18n.hr.customer.fields.accnumb}"}}],dockedItems:[{xtype:"form",dock:"bottom",width:100,defaults:{anchor:"100%"},header:!1,title:"My Form",fieldDefaults:{labelAlign:"right"},layout:{type:"hbox",align:"stretch"},items:[{xtype:"container",flex:1,layout:"form",items:[{xtype:"textfield",name:"name",bind:{fieldLabel:"{i18n.hr.party.fields.name}"}},{xtype:"textfield",name:"taxid",bind:{fieldLabel:"{i18n.hr.party.fields.identity}"}},{xtype:"textfield",name:"address",bind:{fieldLabel:"{i18n.hr.party.fields.address}"}},{xtype:"textfield",name:"accnumb",bind:{fieldLabel:"{i18n.hr.customer.fields.accnumb}"}}]},{xtype:"container",layout:{type:"vbox",align:"stretch",padding:5},items:[{xtype:"button",flex:1,bind:{text:"{i18n.document.search.ui.search}"},listeners:{click:{fn:"onButtonClick",scope:"controller"}}}]}]}],listeners:{resize:{fn:"onGridpanelResize",scope:"controller"},afterrender:"onGridpanelAfterRender"},onGridpanelAfterRender:function(e,t){e.addDocked(new Ext.PagingToolbar({displayInfo:!0,dock:"bottom",afterPageText:" / {0}",beforePageText:i18n.ui.page,emptyMsg:i18n.ui.emptyMsg,displayMsg:i18n.ui.displayMsg,bind:{store:"{customer}"}}))}}),Ext.define("Tel100.view.bs.customer.PanelViewController",{extend:"Ext.app.ViewController",alias:"controller.bscustomerpanel",onButtonClick:function(e,t,n){var o=this.getView().down("form"),i=o.getValues();this.getStore("customer").getProxy().setExtraParams(i);var d=this.getStore("customer");d.removeAll(),d.currentPage=1,this.getStore("customer").load()},onGridpanelResize:function(e,t,n,o,i,d){}}),Ext.define("Tel100.view.bs.customer.PanelViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.bscustomerpanel",stores:{customer:{pageSize:10,model:"Tel100.model.bs.Customer"}}}),Ext.define("Tel100.view.document.comment.Author",{extend:"Ext.window.Window",alias:"widget.documentcommentauthor",viewModel:{type:"documentcommentauthor"},height:250,width:400,defaultListenerScope:!0,layout:{type:"vbox",align:"stretch",padding:5},bind:{title:"{i18n.document.comment.actions.author_document}"},items:[{xtype:"segmentedbutton",items:[{itemId:"sign",enableToggle:!0,pressed:!0,bind:{text:"{i18n.document.comment.actions.author_ok}"},listeners:{toggle:"onSignToggle"}},{enableToggle:!0,bind:{text:"{i18n.document.comment.actions.author_cancel}"}}]},{xtype:"textareafield",flex:1,itemId:"comment",labelAlign:"top",bind:{fieldLabel:"{i18n.document.comment.text}",value:"{text}"}}],dockedItems:[{xtype:"toolbar",flex:1,dock:"bottom",items:[{xtype:"button",bind:{text:"{i18n.ui.save}"},listeners:{click:"onSaveButtonClick"}},{xtype:"tbspacer",flex:1},{xtype:"button",bind:{text:"{i18n.ui.cancel}"},listeners:{click:"onCancelButtonClick"}}]}],onSignToggle:function(e,t,n){var o=this.getViewModel();o.set("response_type",t?helpers.api.document.responseType.complete:helpers.api.document.responseType.cancel)},onSaveButtonClick:function(e,t,n){var o=this,i=this.getViewModel(),d=i.get("text"),a=i.get("response_type"),r=i.get("document.id");helpers.api.document.comment.author({params:{document_id:r,text:d,response_type:a},success:function(){o.fireEvent("authored"),o.close()}})},onCancelButtonClick:function(e,t,n){this.close()}}),Ext.define("Tel100.view.document.comment.AuthorViewController",{extend:"Ext.app.ViewController",alias:"controller.documentcommentauthor"}),Ext.define("Tel100.view.document.comment.AuthorViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.documentcommentauthor",data:{response_type:helpers.api.document.responseType.complete,text:""}}),Ext.define("Tel100.view.document.comment.Panel",{extend:"Ext.panel.Panel",alias:"widget.documentcommentpanel",controller:"documentcommentpanel",viewModel:{type:"documentcommentpanel"},layout:"fit",defaultListenerScope:!0,bind:{title:"{i18n.document.comment.panelTitle} ({commentCount})"},tools:[{xtype:"tool",type:"refresh",listeners:{click:"onToolClick"}}],items:[{xtype:"gridpanel",bind:{store:"{comments}"},columns:[{xtype:"gridcolumn",renderer:function(e,t,n,o,i,d,a){var r=n.get("status"),l=n.get("old_status");return r===l?'<i class="fa fa-comment text-muted"></i>':r>l?'<i class="fa fa-check"></i>':'<i class="fa fa-times"></i>'},width:32,sortable:!1},{xtype:"gridcolumn",width:150,sortable:!1,dataIndex:"user",bind:{text:"{i18n.document.comment.author}"}},{xtype:"gridcolumn",width:200,sortable:!1,dataIndex:"text",bind:{text:"{i18n.document.comment.text}"}},{xtype:"gridcolumn",width:125,sortable:!1,dataIndex:"created_at",formatter:'date("d/m/Y H:i")',bind:{text:"{i18n.document.comment.date}"}}],viewConfig:{getRowClass:function(e,t,n,o){var i=e.get("status"),d=e.get("old_status");return i===d?"":i>d?"text-success":"text-danger"}}}],onToolClick:function(e,t,n,o){this.refresh()},refresh:function(e){this.down("gridpanel").getStore().load({scope:this,callback:e})},onStoreLoad:function(e,t,n,o){var i=this.getViewModel();i.set("commentCount",e.count())}}),Ext.define("Tel100.view.document.comment.PanelViewController",{extend:"Ext.app.ViewController",alias:"controller.documentcommentpanel",onStoreLoad:function(e,t,n,o){}
}),Ext.define("Tel100.view.document.comment.PanelViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.documentcommentpanel",data:{commentCount:0},stores:{comments:{autoLoad:!0,model:"Tel100.model.document.Comment",proxy:{type:"ajax",extraParams:{document_id:"{document.id}"},url:"/api/documents/comments",reader:{type:"json"}},listeners:{load:"onStoreLoad"}}}}),Ext.define("Tel100.view.document.comment.Sign",{extend:"Ext.window.Window",alias:"widget.documentcommentsign",viewModel:{type:"documentcommentsign"},height:250,width:400,defaultListenerScope:!0,layout:{type:"vbox",align:"stretch",padding:5},bind:{title:"{i18n.document.comment.actions.sign_document}"},items:[{xtype:"segmentedbutton",items:[{itemId:"sign",enableToggle:!0,pressed:!0,bind:{text:"{i18n.document.comment.actions.sign_ok}"},listeners:{toggle:"onSignToggle"}},{enableToggle:!0,bind:{text:"{i18n.document.comment.actions.sign_cancel}"}}]},{xtype:"textareafield",flex:1,itemId:"comment",labelAlign:"top",bind:{fieldLabel:"{i18n.document.comment.text}",value:"{text}"}}],dockedItems:[{xtype:"toolbar",flex:1,dock:"bottom",items:[{xtype:"button",bind:{text:"{i18n.ui.save}"},listeners:{click:"onSaveButtonClick"}},{xtype:"tbspacer",flex:1},{xtype:"button",bind:{text:"{i18n.ui.cancel}"},listeners:{click:"onCancelButtonClick"}}]}],onSignToggle:function(e,t,n){var o=this.getViewModel();o.set("response_type",t?helpers.api.document.responseType.complete:helpers.api.document.responseType.cancel)},onSaveButtonClick:function(e,t,n){var o=this,i=this.getViewModel(),d=i.get("text"),a=i.get("response_type"),r=i.get("document.id");helpers.api.document.comment.sign({params:{document_id:r,text:d,response_type:a},success:function(){o.fireEvent("signed"),o.close()}})},onCancelButtonClick:function(e,t,n){this.close()}}),Ext.define("Tel100.view.document.comment.SignViewController",{extend:"Ext.app.ViewController",alias:"controller.documentcommentsign"}),Ext.define("Tel100.view.document.comment.SignViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.documentcommentsign",data:{response_type:helpers.api.document.responseType.complete,text:""}}),Ext.define("Tel100.view.document.editor.Creator",{extend:"Ext.container.Container",alias:"widget.documenteditorcreator",controller:"documenteditorcreator",viewModel:{type:"documenteditorcreator"},border:!1,layout:"border",defaultListenerScope:!0,listeners:{beforerender:{fn:"onBeforeRender",scope:"controller"},documentchange:{fn:"onDocumentChange",buffer:500,scope:"controller"}},items:[{xtype:"tabpanel",region:"center",activeTab:0,deferredRender:!1,tabPosition:"bottom",items:[{xtype:"panel",border:!1,layout:"border",bodyBorder:!1,bind:{title:"{i18n.document.base.ui.newDocumentTab}"},dockedItems:[{xtype:"toolbar",region:"north",dock:"top",border:!1,items:[{xtype:"button",bind:{disabled:"{sendButtonDisabled}",text:"{i18n.document.base.ui.send}"},listeners:{click:{fn:"onSendClick",scope:"controller"}}},{xtype:"button",bind:{disabled:"{saveButtonDisabled}",text:"{saveButtonText}"},listeners:{click:{fn:"onSaveClick",scope:"controller"}}},{xtype:"tbfill"}]}],items:[{xtype:"container",flex:1,region:"center",baseCls:"white-panel",border:!1,layout:{type:"vbox",align:"stretch"},items:[{xtype:"textfield",submitEmptyText:!1,padding:5,labelAlign:"top",emptyText:"enter document's subject",bind:{fieldLabel:"{i18n.document.base.subject}",value:"{document.subject}"}},{xtype:"htmleditor",flex:1,itemId:"documentBody",padding:"0 5 5 5",labelAlign:"top",bind:{fieldLabel:"{i18n.document.base.body}"},listeners:{change:"onHtmleditorChange"}}]},{xtype:"container",region:"east",split:!0,border:!1,width:400,layout:{type:"accordion",hideCollapseTool:!0},items:[{xtype:"documenteditorgeneral",bind:{title:"{i18n.document.base.ui.generalTabTitle}"}},{xtype:"documentrelationpanel",itemId:"relations"},{xtype:"documentmotionssigneepanel",listeners:{datachanged:"onSigneesChanged"}},{xtype:"documentmotionsassigneepanel",listeners:{datachanged:"onAssigneeChange"}},{xtype:"documentmotionsauthorpanel",listeners:{datachanged:"onAuthorsChanged"}},{xtype:"documentfilepanel",itemId:"files"}]}]},{xtype:"panel",border:!1,layout:"fit",bodyBorder:!1,bind:{title:"{i18n.document.base.ui.motionsTabTitle}"},items:[{xtype:"documentmotionsoutpanel",border:!1,bodyBorder:!1,listeners:{draftmotionchanged:"onDraftmotionChanged",datachanged:"onReceiversChanged"}}]}]}],onHtmleditorChange:function(e,t,n,o){var i=e.up("documenteditorcreator"),d=i.getViewModel(),a=d.get("document");a.set("body",t)},onSigneesChanged:function(e,t,n){this.down("documentmotionsoutpanel").refresh()},onAssigneeChange:function(e,t,n){this.down("documentmotionsoutpanel").refresh()},onAuthorsChanged:function(e,t,n){this.down("documentmotionsoutpanel").refresh()},onDraftmotionChanged:function(e){var t=this.getViewModel();t.set("hasDraftMotion",e)},onReceiversChanged:function(e,t,n){var o=this.down("documentmotionssigneepanel"),i=this.down("documentmotionsassigneepanel"),d=this.down("documentmotionsauthorpanel");o.refresh(),i.refresh(),d.refresh()},setDocument:function(e){var t=this.down("#documentBody"),n=this.getViewModel();n.set("document",e),t.setValue(e.get("body"))}}),Ext.define("Tel100.view.document.editor.CreatorViewController",{extend:"Ext.app.ViewController",alias:"controller.documenteditorcreator",onBeforeRender:function(e,t){var n=this.getView(),o=this.getViewModel(),i=function(){var e=o.get("document");e.dirty&&o.set("isSaved",!1),n.fireEvent("documentchange",e)},d={deep:!0};o.bind("{document}",i,this,d);var a=n.down("#files");a.setEditable(!0);var r=n.down("#relations");r.setEditable(!0)},onDocumentChange:function(e){var t=this.getViewModel();if(e&&(t.set("hasSubject",e.get("subject")),t.set("hasBody",e.get("body"))),e.dirty){t.set("isSaving",!0);var n=e.getChanges();helpers.api.document.base.updateDraft(e.id,{params:n,success:function(){e.commit(!0),t.set("isSaved",!0),t.set("isSaving",!1)}.bind(this),failure:function(){console.log("failed to save document"),t.set("isSaving",!1)}})}},onSendClick:function(e,t,n){var o=this.getViewModel(),i=o.get("isSending");if(!i){{var d=this.getView(),a=o.get("document"),r=a.get("subject");a.get("body")}if(!r)return void Ext.Msg.alert(i18n.errors.title,i18n.document.base.errors.empty_subject);o.set("isSending",!0),helpers.api.document.base.sendDraft(a.id,{success:function(){d.fireEvent("documentsent",a)}.bind(this),failure:function(e){Ext.Msg.alert(i18n.errors.title,e),o.set("isSending",!1)}.bind(this)})}},onSaveClick:function(e,t,n){var o=this.getViewModel().get("document");this.onDocumentChange(o)}}),Ext.define("Tel100.view.document.editor.CreatorViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.documenteditorcreator",data:{document:null,isSaving:!1,isSaved:!0,isSending:!1},formulas:{saveButtonText:function(e){var t=e("isSaving"),n=e("isSaved");return t?i18n.ui.saving:n?i18n.ui.saved:i18n.ui.save},saveButtonDisabled:function(e){var t=e("isSaving"),n=e("isSaved");return t||n},sendButtonDisabled:function(e){return e("isSending")?!0:e("hasDraftMotion")&&e("hasSubject")?!1:!0}}}),Ext.define("Tel100.view.document.editor.Editor",{extend:"Ext.container.Container",alias:"widget.documenteditoreditor",controller:"documenteditoreditor",viewModel:{type:"documenteditoreditor"},layout:"border",defaultListenerScope:!0,items:[{xtype:"tabpanel",region:"center",border:!1,padding:"",activeTab:0,deferredRender:!1,tabPosition:"bottom",dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",bind:{text:"{i18n.document.comment.actions.reply}"},listeners:{click:{fn:"onReplyClick",scope:"controller"}}},{xtype:"button",bind:{text:"{i18n.document.base.ui.card}"},listeners:{click:{fn:"onCardPrintClick",scope:"controller"}}},{xtype:"button",bind:{text:"{i18n.ui.print}"},listeners:{click:{fn:"onDocumentPrintClick",scope:"controller"}}},{xtype:"button",bind:{hidden:"{hideSignButton}",text:"{i18n.document.comment.actions.sign}"},listeners:{click:"onSignDocument"}},{xtype:"button",bind:{hidden:"{hideAuthorButton}",text:"{i18n.document.comment.actions.author}"},listeners:{click:"onAuthorDocument"}}]}],items:[{xtype:"panel",border:!1,layout:"border",bind:{title:"{i18n.document.base.ui.contentTabTitle}"},items:[{xtype:"container",region:"center",layout:{type:"vbox",align:"stretch"},items:[{xtype:"form",margins:"0",autoScroll:!0,border:!1,cls:"document-subject",resizable:!1,layout:{type:"vbox",align:"stretch"},items:[{xtype:"displayfield",flex:1,itemId:"fldAuthors",shrinkWrap:2,fieldStyle:"height: inherit",bind:{fieldLabel:"{i18n.document.base.authors}",value:"{authors}"}},{xtype:"displayfield",flex:1,itemId:"fldDocumentInfo",shrinkWrap:2,width:"100%",fieldStyle:"height: inherit",bind:{fieldLabel:"{i18n.document.base.doc}",value:"{docinfo}"}},{xtype:"displayfield",flex:1,itemId:"fldSignees",shrinkWrap:2,fieldStyle:"height: inherit",bind:{hidden:"{hideSignees}",fieldLabel:"{i18n.document.base.signees}",value:"{signees}"}},{xtype:"displayfield",flex:1,itemId:"fldIncoming",shrinkWrap:2,fieldStyle:"height: inherit",bind:{hidden:"{hideIncoming}",fieldLabel:"{i18n.document.base.from}",value:"{incoming}"}},{xtype:"displayfield",flex:1,itemId:"fldOutgoing",shrinkWrap:2,fieldStyle:"height: inherit",bind:{hidden:"{hideOutgoing}",fieldLabel:"{i18n.document.base.to}",value:"{outgoing}"}},{xtype:"textfield",flex:1,width:"100%",editable:!1,bind:{fieldLabel:"{i18n.document.base.subject}",value:"{document.subject}"}}]},{xtype:"container",flex:1,cls:"document-body",overflowY:"scroll",bind:{html:"{document.body}"}}]},{xtype:"container",region:"east",split:!0,width:400,layout:{type:"accordion",hideCollapseTool:!0},items:[{xtype:"documenteditorgeneral",bind:{title:"{i18n.document.base.ui.generalTabTitle}"}},{xtype:"documentmotionssignaturesviewer"},{xtype:"documentmotionsreceiverspanel"},{xtype:"documentmotionstree"},{xtype:"documentmotionsresultpanel",listeners:{commentadded:"onPanelCommentadded"}},{xtype:"documentcommentpanel"},{xtype:"documentfilepanel"},{xtype:"documentrelationpanel"}]}]},{xtype:"panel",border:!1,layout:{type:"hbox",align:"stretch"},bind:{title:"{i18n.document.base.ui.motionsTabTitle}"},items:[{xtype:"documentmotionsinpanel",flex:1,listeners:{motionchanged:{fn:"onInMotionChanged",scope:"controller"}}},{xtype:"splitter",width:5},{xtype:"documentmotionsoutpanel",border:!1,flex:1}]}]}],listeners:{destroy:{fn:"onDestroy",scope:"controller"},afterrender:{fn:"onContainerAfterRender",scope:"controller"}},onSignDocument:function(e,t,n){var o=this,i=o.getViewModel(),d=i.get("document"),a=Ext.create("Tel100.view.document.comment.Sign",{modal:!0});a.getViewModel().set("document",d),a.on("signed",function(){o.refresh()}),a.show()},onAuthorDocument:function(e,t,n){var o=this,i=o.getViewModel(),d=i.get("document"),a=Ext.create("Tel100.view.document.comment.Author",{modal:!0});a.getViewModel().set("document",d),a.on("authored",function(){o.refresh()}),a.show()},onPanelCommentadded:function(e){var t=this.down("documentcommentpanel");t.refresh(function(){t.setCollapsed(!1)})},initComponent:function(){this.callParent();var e=this.down("documenteditorgeneral");e.setReadonly(!0)},refresh:function(){var e=this,t=e.getViewModel(),n=t.get("document");n.load({callback:function(){var t=e.down("documentcommentpanel"),n=e.down("documentmotionstree");t.refresh(),n.refresh()}})}}),Ext.define("Tel100.view.document.editor.EditorViewController",{extend:"Ext.app.ViewController",alias:"controller.documenteditoreditor",onReplyClick:function(e,t,n){var o=this.getViewModel(),i=o.get("document");helpers.api.document.base.reply(i.id,{success:function(e){var t=Ext.create("Tel100.model.document.Base",e),n=this.getView().up("documentmain");n.getViewModel().set("selection",t),n.getController().openDocument(t)}.bind(this)})},onCardPrintClick:function(e,t,n){var o=this.getViewModel(),i=o.get("document"),d="/api/documents/print/card/"+i.id;helpers.api.document.print.showPDFwindow(d)},onDocumentPrintClick:function(e,t,n){var o=this.getViewModel(),i=o.get("document"),d="/api/documents/print/document/"+i.id;helpers.api.document.print.showPDFwindow(d)},onInMotionChanged:function(e){var t=this.getView(),n=t.down("documentmotionsoutpanel");n.setParentId(e&&"document"!==e.get("type")?e.id:null),n.refresh()},onDestroy:function(e,t){e.commentsDialog&&e.commentsDialog.destroy()},onContainerAfterRender:function(e,t){helpers.party.employeeTips(e)}}),Ext.define("Tel100.view.document.editor.EditorViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.documenteditoreditor",data:{document:null},formulas:{hideSignButton:function(e){return 1!==e("document.as_signee")},hideAuthorButton:function(e){return 1!==e("document.as_author")},authors:function(e){var t=e("document.authors"),n=[];if(t.length){for(var o=0;o<t.length;o++){var i=t[o],d=helpers.document.status.statusDecoration(i.status);n.push(['<span class="'+d.style+'">','<i class="fa '+d.icon+'"></i> ','<a data-id="'+i.author_id+'" data-class="'+i.author_type+'">'+i.name+"</a>",i.response?" &mdash; "+i.response:"","</span>"].join(""))}return n.join("; ")}var a=e("document.status"),d=helpers.document.status.statusDecoration(a),r=e("document.sender_name"),l=e("document.sender_id"),s=e("document.sender_type");return['<span class="'+d.style+'">','<i class="fa '+d.icon+'"></i> ','<a data-id="'+l+'" data-class="'+s+'">'+r+"</a>","</span>"].join("")},hideSignees:function(e){var t=e("document.signees");return!t||0===t.length},signees:function(e){for(var t=e("document.signees"),n=[],o=0;o<t.length;o++){var i=t[o],d=helpers.document.status.statusDecoration(i.status);n.push(['<span class="'+d.style+'">','<i class="fa '+d.icon+'"></i> ','<a data-id="'+i.signee_id+'" data-class="'+i.signee_type+'">'+i.name+"</a>",i.response?" &mdash; "+i.response:"","</span> ",i.completed_at?'<span class="text-danger">'+i.completed_at+"</span>":""].join(""))}return n.join("; ")},docinfo:function(e){var t=e("document.docnumber"),n=e("document.type.name"),o=e("document.status"),i=helpers.document.status.statusDecoration(o),d=e("document.sender_name"),a=e("document.sender_id"),r=e("document.sender_type"),l=e("document.sent_at_f");return['<span class="'+i.style+'">','<i class="fa '+i.icon+'"></i> ',"<strong>"+t+"</strong>","</span> ",'<span class="text-muted">'+n+"</span> &mdash; ",'<strong><a data-id="'+a+'" data-class="'+r+'">'+d+"</a></strong>, ",'<span class="text-danger">'+l+"</span>"].join("")},incoming:function(e){var t=e("document.incoming"),n=[];return t.forEach(function(e){n.push(helpers.document.renderer.renderMotion(e,{as:"sender"}))}),n.join("; ")},hideIncoming:function(e){return!e("document.incoming").length},outgoing:function(e){var t=e("document.outgoing"),n=[];return t.forEach(function(e){n.push(helpers.document.renderer.renderMotion(e,{as:"receiver"}))}),n.join("; ")},hideOutgoing:function(e){return!e("document.outgoing").length}}}),Ext.define("Tel100.view.document.editor.General",{extend:"Ext.form.Panel",alias:"widget.documenteditorgeneral",controller:"documenteditorgeneral",viewModel:{type:"documenteditorgeneral"},autoScroll:!0,bodyPadding:5,items:[{xtype:"textfield",anchor:"100%",editable:!1,bind:{fieldLabel:"{i18n.document.base.sender}",value:"{document.sender_name}"}},{xtype:"combobox",anchor:"100%",editable:!1,displayField:"name",valueField:"id",bind:{fieldLabel:"{i18n.document.base.type}",value:"{document.type_id}",readOnly:"{readonly}",store:"{types}"},listeners:{change:"onTypeIdChange"}},{xtype:"textfield",anchor:"100%",bind:{fieldLabel:"{i18n.document.base.docnumber}",value:"{document.docnumber}",readOnly:"{readonly}"}},{xtype:"datefield",format:"d/m/Y",bind:{fieldLabel:"{i18n.document.base.docdate}",value:"{document.docdate}",readOnly:"{readonly}"}},{xtype:"datefield",format:"d/m/Y",bind:{fieldLabel:"{i18n.document.base.due_date}",value:"{document.due_date}",readOnly:"{readonly}"}},{xtype:"numberfield",anchor:"100%",minValue:0,bind:{fieldLabel:"{i18n.document.base.page_count}",value:"{document.page_count}",readOnly:"{readonly}"}},{xtype:"numberfield",anchor:"100%",minValue:0,bind:{fieldLabel:"{i18n.document.base.additions_count}",value:"{document.additions_count}",readOnly:"{readonly}"}},{xtype:"combobox",anchor:"100%",editable:!1,displayField:"name",valueField:"id",bind:{fieldLabel:"{i18n.document.base.direction}",value:"{document.direction}",readOnly:"{readonly}",store:"{directions}"}},{xtype:"fieldset",bind:{hidden:"{!isIncoming}",title:"{i18n.document.base.in_fields}"},items:[{xtype:"textfield",anchor:"100%",bind:{fieldLabel:"{i18n.document.base.original_number}",value:"{document.original_number}",readOnly:"{readonly}"}},{xtype:"datefield",anchor:"100%",format:"d/m/Y",bind:{fieldLabel:"{i18n.document.base.original_date}",value:"{document.original_date}",readOnly:"{readonly}"}}]}],getReadonly:function(){return this.getViewModel().get("readonly")},setReadonly:function(e){return this.getViewModel().set("readonly",e)}}),Ext.define("Tel100.view.document.editor.GeneralViewController",{extend:"Ext.app.ViewController",alias:"controller.documenteditorgeneral",onTypeIdChange:function(e,t,n,o){var i=this.getViewModel(),d=i.get("document");d.dirty&&d.set("type",e.getSelectedRecord())}}),Ext.define("Tel100.view.document.editor.GeneralViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.documenteditorgeneral",data:{readonly:!1},stores:{types:{autoLoad:!0,model:"Tel100.model.document.Type"},directions:{autoLoad:!0,model:"Tel100.model.document.Direction",proxy:{type:"memory",data:[{id:"inner"},{id:"out"},{id:"in"}]}}},formulas:{isIncoming:function(e){return"in"===e("document.direction")}}}),Ext.define("Tel100.view.document.file.Panel",{extend:"Ext.panel.Panel",alias:"widget.documentfilepanel",controller:"documentfilepanel",viewModel:{type:"documentfilepanel"},border:!1,layout:"fit",defaultListenerScope:!0,bind:{title:"{i18n.document.file.attachments} ({fileCount})"},dockedItems:[{xtype:"toolbar",dock:"top",border:0,bind:{hidden:"{notEditable}"},items:[{xtype:"form",border:!1,padding:0,bodyPadding:0,items:[{xtype:"filefield",cls:"file-upload",padding:0,name:"file",buttonText:'<i class="fa fa-plus"></i>',listeners:{change:{fn:"onFilefieldChange",scope:"controller"}}}]}]}],items:[{xtype:"gridpanel",autoScroll:!0,border:!1,hideHeaders:!0,scroll:"vertical",bind:{store:"{files}"},columns:[{xtype:"gridcolumn",dataIndex:"name",flex:1},{xtype:"actioncolumn",width:24,bind:{hidden:"{notEditable}"},items:[{handler:function(e,t,n,o,i,d,a){var r=d.id;helpers.api.document.file["delete"](r,{success:function(){e.up("documentfilepanel").refresh()}})},icon:"/images/delete.gif"}]}],listeners:{celldblclick:{fn:"onGridpanelCellDblClick",scope:"controller"}}}],tools:[{xtype:"tool",type:"refresh",listeners:{click:"onRefresh"}}],onRefresh:function(e,t,n,o){this.refresh()},refresh:function(){var e=this.getViewModel();e.getStore("files").load()},initComponent:function(){this.callParent();var e=this,t=this.getViewModel();t.bind("{files}",function(n){n&&(n.view=e,n.viewModel=t)})},setEditable:function(e){var t=this.getViewModel();t.set("editable",e)},getEditable:function(){var e=this.getViewModel();return e.get("editable")}}),Ext.define("Tel100.view.document.file.PanelViewController",{extend:"Ext.app.ViewController",alias:"controller.documentfilepanel",onFilefieldChange:function(e,t,n){if(t){var o=e.up("form").getForm(),i=this.getViewModel(),d=this.getView(),a=i.get("document");o.submit({url:"/api/documents/files/upload?document_id="+a.id,success:function(){d.refresh()}})}},onGridpanelCellDblClick:function(e,t,n,o,i,d,a,r){var l="/api/documents/files/download?id="+o.id,s=window.open(l,"tel100");s.focus()}}),Ext.define("Tel100.view.document.file.PanelViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.documentfilepanel",data:{fileCount:0,editable:!1},stores:{files:{listeners:{datachanged:function(){var e=this;this.viewModel.set("fileCount",e.getCount()),this.view.fireEvent("fileschanged",e)}},autoLoad:!0,model:"Tel100.model.document.File",proxy:{type:"ajax",extraParams:{document_id:"{document.id}"},url:"/api/documents/files",reader:{type:"json"}}}},formulas:{notEditable:function(e){return!e("editable")}}}),Ext.define("Tel100.view.document.folder.Config",{extend:"Ext.window.Window",alias:"widget.documentfolderconfig",controller:"documentfolderconfig",viewModel:{type:"documentfolderconfig"},height:353,width:303,layout:"fit",modal:!0,bind:{title:"{i18n.document.folder.categories.b}"},items:[{xtype:"gridpanel",header:!1,title:"My Grid Panel",hideHeaders:!0,store:"CustomFolders",columns:[{xtype:"gridcolumn",renderer:function(e,t,n,o,i,d,a){return helpers.api.folders.folderDecoration(n.get("folder_type"),n.get("name"))},dataIndex:"name",text:"String",flex:1}],selModel:{selType:"rowmodel"}}],dockedItems:[{xtype:"toolbar",dock:"right",vertical:!0,items:[{xtype:"button",text:"+",listeners:{click:"onPlusButtonClick"}},{xtype:"button",text:"-",listeners:{click:"onMinusButtonClick"}},{xtype:"button",text:"^"},{xtype:"button",text:"v"}]}]}),Ext.define("Tel100.view.document.folder.ConfigViewController",{extend:"Ext.app.ViewController",alias:"controller.documentfolderconfig",onPlusButtonClick:function(e,t,n){Ext.MessageBox.prompt("Folder","Enter name",function(e,t){"ok"==e&&(Ext.Ajax.request({url:"/api/folder",method:"POST",params:{name:t,folder_type:0},success:function(e){var t=Ext.getStore("CustomFolders");t.reload()},failure:function(e){Ext.MessageBox.alert("error")}}),close())})},onMinusButtonClick:function(e,t,n){var o=e.up("window").down("grid"),i=o.store,d=o.selection;d&&Ext.Msg.show({title:i18n.ui.destroy,message:i18n.ui.destroyConfirm,buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(e){"yes"===e&&(i.remove(d),i.sync(),i.reload())}})}}),Ext.define("Tel100.view.document.folder.ConfigViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.documentfolderconfig"}),Ext.define("Tel100.view.document.folder.Search",{extend:"Ext.form.Panel",alias:"widget.documentfoldersearch",controller:"documentfoldersearch",viewModel:{type:"documentfoldersearch"},autoScroll:!0,bodyPadding:10,url:"/api/documents/base/search",items:[{xtype:"combobox",anchor:"100%",name:"folder",editable:!1,displayField:"name",valueField:"id",bind:{fieldLabel:"{i18n.document.search.folder}",store:"{standardFolders}"}},{xtype:"combobox",anchor:"100%",name:"type",editable:!1,displayField:"name",valueField:"id",bind:{fieldLabel:"{i18n.document.search.type}",store:"{types}"}},{xtype:"combobox",anchor:"100%",name:"direction",editable:!1,displayField:"name",valueField:"id",bind:{fieldLabel:"{i18n.document.search.direction}",store:"{direction}"}},{xtype:"textfield",anchor:"100%",name:"subject",bind:{fieldLabel:"{i18n.document.search.subject}"}},{xtype:"textfield",anchor:"100%",name:"original_number",bind:{fieldLabel:"{i18n.document.search.original_number}"}},{xtype:"textfield",anchor:"100%",name:"docnumber",bind:{fieldLabel:"{i18n.document.search.docnumber}"}},{xtype:"spinnerfield",anchor:"100%",name:"docyear",bind:{fieldLabel:"{i18n.document.search.docyear}"}},{xtype:"textfield",anchor:"100%",name:"sender",bind:{fieldLabel:"{i18n.document.search.sender}"}},{xtype:"textfield",anchor:"100%",name:"author",bind:{fieldLabel:"{i18n.document.search.author}"}},{xtype:"textfield",anchor:"100%",name:"assignee",bind:{fieldLabel:"{i18n.document.search.assignee}"}},{xtype:"textfield",anchor:"100%",name:"signee",bind:{fieldLabel:"{i18n.document.search.signee}"}},{xtype:"fieldcontainer",anchor:"100%",layout:{type:"hbox",align:"stretch"},bind:{fieldLabel:"{i18n.document.search.customer}"},items:[{xtype:"textfield",flex:1,name:"customer"},{xtype:"button",width:25,text:"...",listeners:{click:"onChoseCustomerButtonClick"}}]},{xtype:"spinnerfield",anchor:"100%",name:"page_count",bind:{fieldLabel:"{i18n.document.search.page_count}"}},{xtype:"fieldset",layout:"form",bind:{title:"{i18n.document.search.docdate}"},items:[{xtype:"datefield",name:"docdate_from",format:"d/m/Y",bind:{fieldLabel:"{i18n.document.search.from}"}},{xtype:"datefield",name:"docdate_to",format:"d/m/Y",bind:{fieldLabel:"{i18n.document.search.to}"}}]},{xtype:"button",width:"100%",bind:{text:"{i18n.document.search.buttons.search}"},listeners:{click:"onSearchButtonClick"}},{xtype:"button",width:"100%",bind:{text:"{i18n.document.search.buttons.reset}"},listeners:{click:"onResetButtonClick"}},{xtype:"button",formBind:!0,width:"100%",bind:{text:"{i18n.document.search.buttons.savefilter}"},listeners:{click:"onSaveFilterButtonClick"}}]}),Ext.define("Tel100.view.document.folder.SearchViewController",{extend:"Ext.app.ViewController",alias:"controller.documentfoldersearch",search:function(){var e=this.getView(),t=e.getForm().getValues(),n="/api/documents/base/search";e.fireEvent("searchstart",n,t),e.up().fireEvent("folderChosen")},onChoseCustomerButtonClick:function(e,t,n){var o=Ext.create("Tel100.view.party.Selector",{title:i18n.document.search.choseCustomer,viewModel:{data:{hideHR:!0,hideParty:!0,hideCustomers:!1}}});o.show(),o.on("selectioncomplete",function(e){if(e.length>0){var t=e[0];this.getView().getForm().setValues({customer:t.get("custkey")})}}.bind(this))},onSearchButtonClick:function(e,t,n){this.search()},onResetButtonClick:function(e,t,n){e.up("form").reset()},onSaveFilterButtonClick:function(e,t,n){var o=Ext.encode(e.up("form").getForm().getValues());Ext.MessageBox.prompt("Folder","Enter name",function(e,t){"ok"==e&&(Ext.Ajax.request({url:"/api/folder",method:"POST",params:{name:t,folder_type:1,form:o},success:function(e){var t=Ext.getStore("CustomFolders");t.reload()},failure:function(e){Ext.MessageBox.alert("error")}}),close())})}}),Ext.define("Tel100.view.document.folder.SearchViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.documentfoldersearch",stores:{types:{autoLoad:!0,model:"Tel100.model.document.Type"},standardFolders:{autoLoad:!0,model:"Tel100.model.folder.Standard"},direction:{autoLoad:!0,model:"Tel100.model.document.Direction",proxy:{type:"memory",data:[{id:"inner"},{id:"out"},{id:"in"}]}}}}),Ext.define("Tel100.view.document.folder.Tab",{extend:"Ext.tab.Panel",alias:"widget.documentfoldertab",controller:"documentfoldertab",viewModel:{type:"documentfoldertab"},header:!1,activeTab:0,defaultListenerScope:!0,items:[{xtype:"panel",layout:{type:"vbox",align:"stretch"},bind:{title:"{i18n.document.folder.ui.folders}"},items:[{xtype:"gridpanel",border:!1,itemId:"standardFolders",enableColumnHide:!1,enableColumnMove:!1,enableColumnResize:!1,hideHeaders:!0,sortableColumns:!1,bind:{store:"{standardfolders}"},columns:[{xtype:"gridcolumn",renderer:function(e,t,n,o,i,d,a){var r;return r=n.data.parent_id?'<span style="float: left; margin-left: 20px;">'+n.data.icon+" "+e+"</span>":n.data.icon+" "+e,r+'<span style="float:right;">'+n.data.count+"</span>"},sortable:!1,dataIndex:"name",flex:1,bind:{text:"{i18n.document.folder.categories.a}"}}],selModel:{selType:"rowmodel",allowDeselect:!0,mode:"SINGLE"},listeners:{itemclick:{fn:"onStandardGridpanelSelect",scope:"controller"}},dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",text:'<i class="fa fa-refresh"></i>',listeners:{click:{fn:"onRefreshFolderButtonClick",scope:"controller"}}},{xtype:"tbfill"},{xtype:"tbseparator"},{xtype:"button",text:'<span class="text-muted"><i class="fa fa-cog"></i></span>',listeners:{click:"onSetupFoldersButtonClick"}}]}]},{xtype:"gridpanel",flex:1,border:!1,itemId:"customFolders",header:!1,title:"TEST",store:"CustomFolders",columns:[{xtype:"gridcolumn",renderer:function(e,t,n,o,i,d,a){var r=0===n.get("folder_type")?'<span style="float:right;">'+n.data.count+"</span>":"";return helpers.api.folders.folderDecoration(n.get("folder_type"),n.get("name"))+r},enableColumnHide:!1,sortable:!1,dataIndex:"name",hideable:!1,tdCls:"foldercls",flex:1,bind:{text:"{i18n.document.folder.categories.b}"}}],listeners:{afterrender:{fn:"onGridpanelAfterRender",scope:"controller"},select:{fn:"onCustomFoldersSelect",scope:"controller"},beforerender:{fn:"onCustomFoldersBeforeRender",scope:"controller"}}},{xtype:"gridpanel",border:!1,hidden:!0,collapsible:!0,hideHeaders:!0,bind:{title:"{i18n.vacation.ui.grid_title}",store:"{substitudeStore}"},columns:[{xtype:"gridcolumn",dataIndex:"name",flex:1}],listeners:{cellclick:{fn:"onGridpanelCellClick",scope:"controller"}}}]},{xtype:"documentfoldersearch",bind:{title:"{i18n.document.search.ui.search}"}}],listeners:{afterrender:"onTabpanelAfterRender",documentgridrefresh:{fn:"onDocumentGridRefresh",scope:"controller"}},onSetupFoldersButtonClick:function(e,t,n){var o=Ext.create("Tel100.view.document.folder.Config");o.show()},onTabpanelAfterRender:function(e,t){}}),Ext.define("Tel100.view.document.folder.TabViewController",{extend:"Ext.app.ViewController",alias:"controller.documentfoldertab",refreshDocuments:function(e){var t=this.getView().up().down("documentgridpanel"),n="/api/documents/base";t.getController().setStoreConfig({url:n,extraParams:e}),t.refresh()},onGearClick:function(e){var t=Ext.create("Tel100.view.document.folder.Config");t.show()},foldersRefresh:function(){this.getViewModel().getStore("standardfolders").reload(),Ext.getStore("CustomFolders").reload()},onStandardGridpanelSelect:function(e,t,n,o,i,d){this.refreshDocuments({folderType:"standard",folderId:t.id}),this.getView().down("#customFolders").getSelectionModel().deselectAll(),this.getView().up().getViewModel().set("customfolderselection",null),this.getView().fireEvent("folderChosen")},onRefreshFolderButtonClick:function(e,t,n){this.foldersRefresh(),this.getView().fireEvent("foldersrefresh")},onGridpanelAfterRender:function(e,t){e.dropZone=Ext.create("Ext.dd.DropZone",e.el,{ddGroup:"Grid2FolderDDGroup",getTargetFromEvent:function(e){return e.getTarget(".foldercls")},onNodeEnter:function(e,t,n,o){Ext.fly(e).highlight()},onNodeOver:function(e,t,n,o){var i=Ext.ComponentQuery.query("grid[itemId=customFolders]")[0],d=i.getView(),a=d.getRecord(e),r=Ext.dd.DropZone.prototype;return 0===a.get("folder_type")?r.dropAllowed:r.dropNotAllowed},onNodeDrop:function(e,t,n,o){var i=Ext.ComponentQuery.query("grid[itemId=customFolders]")[0],d=i.getView(),a=d.getRecord(e),r=(i.up("panel").getViewModel(),Ext.create("Tel100.model.folder.Document",{folder_id:a.id,doc_id:o.records[0].id}));return r.save(),!0}})},onCustomFoldersSelect:function(e,t,n,o){if(0===t.get("folder_type"))this.refreshDocuments({folderType:"custom",folderId:t.id});else{var i=this.getView(),d=i.down("documentfoldersearch");d.getForm().setValues(Ext.decode(t.get("form"))),d.getController().search()}this.getView().down("#standardFolders").getSelectionModel().deselectAll(),this.getView().up().getViewModel().set("customfolderselection",e.getSelection())},onCustomFoldersBeforeRender:function(e,t){Ext.getStore("CustomFolders").load()},onGridpanelCellClick:function(e,t,n,o,i,d,a,r){var l=this;if(0===Ext.ComponentQuery.query("usersubstitudepanel").length){helpers.api.substitude.setSubstitude(o.get("id"));var s=this.getView().up().down("documentgridpanel"),l=this,c=Ext.create("Tel100.view.user.substitude.Panel",{html:i18n.vacation.ui.substitude_mode.title+o.data.name});c.down("button").on("click",function(){helpers.api.substitude.setSubstitude(null),s.refresh(),l.foldersRefresh()}),c.show().alignTo(Ext.getBody(),"t-t"),this.getView().up().down("documentgridpanel").refresh(),s.refresh(),l.foldersRefresh()}},onDocumentGridRefresh:function(e){this.foldersRefresh()}}),Ext.define("Tel100.view.document.folder.TabViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.documentfoldertab",stores:{documentStore:{model:"Tel100.model.folder.Document"},standardfolders:{autoLoad:!0,model:"Tel100.model.folder.Standard"},substitudeStore:{autoLoad:!1,proxy:{type:"rest",url:"/api/vacation/substitudes"},fields:[{name:"id"},{name:"substitude_type"},{calculate:function(e){return e.first_name+" "+e.last_name},name:"name"},{name:"first_name"},{name:"last_name"},{name:"userid"}]}}}),Ext.define("Tel100.view.document.grid.Panel",{extend:"Ext.grid.Panel",alias:"widget.documentgridpanel",controller:"documentgridpanel",viewModel:{type:"documentgridpanel"},border:!1,enableColumnHide:!1,enableColumnMove:!1,sortableColumns:!1,defaultListenerScope:!0,
bind:{store:"{documents}"},viewConfig:{getRowClass:function(e,t,n,o){var i=e.get("status"),d=helpers.document.status.documentStatusRowClass(i,e),a=e.get("is_changed");return a&&(d+=" text-unread"),e.get("due_is_over")?d+=" danger":e.get("has_due_date")&&(d+=" warning"),d},plugins:[{ptype:"gridviewdragdrop",pluginId:"draganddropplug",ddGroup:"Grid2FolderDDGroup",enableDrop:!1}]},columns:[{xtype:"gridcolumn",renderer:function(e,t,n,o,i,d,a){var r=e;return n.get("is_reply")&&(r=['<i class="fa fa-reply"></i>',e].join(" ")),[r,n.get("typeName")].join("<br>")},width:100,sortable:!1,dataIndex:"docnumber",hideable:!1,lockable:!1,bind:{text:"{i18n.document.base.docnumber}"}},{xtype:"gridcolumn",renderer:function(e,t,n,o,i,d,a){return 1===n.get("as_signee")?'<strong class="text-danger">'+i18n.document.comment.actions.sign+"</strong>":1===n.get("as_author")?'<strong class="text-danger">'+i18n.document.comment.actions.author+"</strong>":void 0},lockable:!1,bind:{text:"{i18n.document.base.actions}"}},{xtype:"gridcolumn",renderer:function(e,t,n,o,i,d,a){var r=[];r.push(e);var l=n.get("current_due_date");return l&&r.push('<span class="text-warning"><i class="fa fa-warning"></i> <strong>'+Ext.Date.format(new Date(l),"d/m/Y")+"</strong></span>"),r.push(n.get("directionName")),r.join("<br>")},width:130,sortable:!1,dataIndex:"statusName",hideable:!1,bind:{text:"{i18n.document.base.status}<br>{i18n.document.base.direction}"}},{xtype:"gridcolumn",renderer:function(e,t,n,o,i,d,a){var r;e&&(r=Ext.Date.format(e,"d/m/Y"));var l,s=helpers.document.user.myStatus(n);l=s.unread?'<i class="fa fa-circle text-danger"></i>':'<i class="fa '+s.icon+'"></i>';var c=['<span class="'+s.style+'">',l+" ",s.name,"</span>"].join("");return[c,r].join("<br>")},width:150,sortable:!1,dataIndex:"docdate",hideable:!1,bind:{text:"{i18n.document.base.my_status}<br>{i18n.document.base.docdate}"}},{xtype:"gridcolumn",renderer:function(e,t,n,o,i,d,a){return helpers.document.motion.formatReceivers(e,t,{prefix:"assignee"})},width:200,sortable:!1,cellWrap:!0,dataIndex:"assignees",hideable:!1,bind:{text:"{i18n.document.base.assignees}"}},{xtype:"gridcolumn",renderer:function(e,t,n,o,i,d,a){return helpers.document.motion.formatReceivers(e,t,{prefix:"author"})},width:200,sortable:!1,cellWrap:!0,dataIndex:"authors",hideable:!1,bind:{text:"{i18n.document.base.authors}"}},{xtype:"gridcolumn",width:150,sortable:!1,dataIndex:"subject",hideable:!1,bind:{text:"{i18n.document.base.subject}"}},{xtype:"gridcolumn",renderer:function(e,t,n,o,i,d,a){return helpers.document.motion.formatReceivers(e,t,{prefix:"signee"})},width:200,sortable:!1,cellWrap:!0,dataIndex:"signees",hideable:!1,bind:{text:"{i18n.document.base.signees}"}},{xtype:"gridcolumn",renderer:function(e,t,n,o,i,d,a){return helpers.document.motion.formatResponses(e,t)},width:200,dataIndex:"incoming",bind:{text:"{i18n.document.base.response}"}},{xtype:"gridcolumn",sortable:!1,dataIndex:"original_number",hideable:!1,bind:{text:"{i18n.document.base.original_number}"}},{xtype:"gridcolumn",dataIndex:"original_date",formatter:'date("d/m/Y")',hideable:!1,bind:{text:"{i18n.document.base.original_date}"}}],listeners:{beforeitemcontextmenu:{fn:"onGridpanelBeforeItemContextMenu",scope:"controller"},afterrender:{fn:"onGridpanelAfterRender",scope:"controller"},celldblclick:"onGridpanelCellDblClick"},onGridpanelCellDblClick:function(e,t,n,o,i,d,a,r){var l=1;n===l&&1===o.get("as_signee")?this.fireEvent("documentsign",o):n===l&&1===o.get("as_author")?this.fireEvent("documentauthor",o):this.fireEvent("documentopen",o)},refresh:function(e){var t=this,n=t.getStore();n.load(e)}}),Ext.define("Tel100.view.document.grid.PanelViewController",{extend:"Ext.app.ViewController",alias:"controller.documentgridpanel",setStoreConfig:function(e,t){var n=this.getStore("documents").getProxy();n.setConfig(e,t);var o=Ext.ComponentQuery.query("#main-viewport")[0].getViewModel().get("substitude");o?n.setExtraParam("substitude",o.get("id")):n.setExtraParam("substitude",null)},moveDocumentToFolder:function(e){var t=Ext.create("Tel100.model.folder.Document",{folder_id:e,doc_id:data.records[0].id});t.save()},addPagingToolbar:function(e){e.addDocked(new Ext.PagingToolbar({displayInfo:!0,dock:"bottom",afterPageText:" / {0}",beforePageText:i18n.ui.page,emptyMsg:i18n.ui.emptyMsg,displayMsg:i18n.ui.displayMsg,bind:{store:"{documents}"}}))},onGridpanelBeforeItemContextMenu:function(e,t,n,o,i,d){var a=t,r=Ext.create("Ext.menu.Menu"),l=Ext.getStore("CustomFolders");l.each(function(e,t){0===e.get("folder_type")&&r.add({text:e.get("name"),handler:function(t){var n=Ext.create("Tel100.model.folder.Document",{folder_id:e.id,doc_id:a.id});n.save()}})});var s=Ext.create("Ext.menu.Menu",{items:[{text:i18n.document.folder.ui.move_to,icon:"/images/move.png",menu:r}]});i.stopEvent(),s.showAt(i.getXY())},onGridpanelAfterRender:function(e,t){this.getView().getController().addPagingToolbar(e),helpers.party.employeeTips(e)}}),Ext.define("Tel100.view.document.grid.PanelViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.documentgridpanel",data:{selectionCriteria:null},stores:{documents:{autoLoad:!0,model:"Tel100.model.document.Base",proxy:{type:"ajax",url:"/api/documents/base",reader:{type:"json",rootProperty:"data"}}}}}),Ext.define("Tel100.view.document.relation.Answer",{extend:"Ext.grid.Panel",alias:"widget.documentrelationanswer",controller:"documentrelationanswer",viewModel:{type:"documentrelationanswer"},border:!1,header:!1,title:"My Grid Panel",bind:{hidden:"{hideAnswers}",store:"{answers}"},columns:[{xtype:"gridcolumn",renderer:function(e,t,n,o,i,d,a){return[e," ",n.get("doctype"),"</a>"].join("")},draggable:!1,resizable:!1,sortable:!1,dataIndex:"docnumber",hideable:!1,flex:1,bind:{text:"{i18n.document.base.answers}"}}],listeners:{celldblclick:"onAnswersGridpanelCellDblClick"}}),Ext.define("Tel100.view.document.relation.AnswerViewController",{extend:"Ext.app.ViewController",alias:"controller.documentrelationanswer",onAnswersGridpanelCellDblClick:function(e,t,n,o,i,d,a,r){var l=this.getView().up("documentmain"),s=Ext.create("Tel100.model.document.Base",{id:o.get("docid")});s.load({success:function(e){l.getController().openDocument(s)}})},onStoreLoad:function(e,t,n,o){var i=this.getViewModel();i.set("hideAnswers",!e.count())}}),Ext.define("Tel100.view.document.relation.AnswerViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.documentrelationanswer",data:{hideAnswers:!0},stores:{answers:{autoLoad:!0,model:"Tel100.model.document.Base",proxy:{type:"ajax",extraParams:{related_id:"{document.id}"},url:"/api/documents/relations/answer",reader:{type:"json"}},listeners:{load:"onStoreLoad"}}}}),Ext.define("Tel100.view.document.relation.Panel",{extend:"Ext.panel.Panel",alias:"widget.documentrelationpanel",controller:"documentrelationpanel",viewModel:{type:"documentrelationpanel"},layout:"fit",defaultListenerScope:!0,bind:{title:"{i18n.document.relation.relations} ({relationCount})"},items:[{xtype:"gridpanel",hideHeaders:!0,scroll:"vertical",bind:{store:"{relations}"},columns:[{xtype:"gridcolumn",renderer:function(e,t,n,o,i,d,a){return"<strong>"+e+'</strong> <span class="text-muted">'+n.get("owner")+"</span>"},dataIndex:"docnumber",text:"document",flex:1},{xtype:"actioncolumn",width:24,bind:{hidden:"{notEditable}"},items:[{handler:function(e,t,n,o,i,d,a){helpers.api.document.relation["delete"]({params:{id:d.id},success:function(t){e.up("documentrelationpanel").refresh()}})},icon:"/images/delete.gif"}]}],listeners:{celldblclick:{fn:"onGridpanelCellDblClick",scope:"controller"}}}],tools:[{xtype:"tool",type:"refresh",listeners:{click:"onRefresh"}},{xtype:"tool",type:"plus",bind:{hidden:"{notEditable}"},listeners:{click:"onAddRelation"}}],onRefresh:function(e,t,n,o){this.refresh()},onAddRelation:function(e,t,n,o){var i=this.getViewModel(),d=i.get("document"),a=this;this.searchDialog||(this.searchDialog=Ext.create("Tel100.view.document.Search",{closeAction:"hide",modal:!0,maximizable:!0}),this.searchDialog.on("documentselected",function(e){helpers.api.document.relation.create({params:{base_id:d.id,related_id:e.id},success:function(e){a.refresh()}})})),this.searchDialog.setParentDocument(d),this.searchDialog.show()},refresh:function(){var e=this,t=e.down("gridpanel");t.getStore().load()},initComponent:function(){this.callParent();var e=this.getViewModel();e.bind("{relations}",function(e){e&&(e.viewModel=this)})},setEditable:function(e){var t=this.getViewModel();t.set("editable",e)}}),Ext.define("Tel100.view.document.relation.PanelViewController",{extend:"Ext.app.ViewController",alias:"controller.documentrelationpanel",onGridpanelCellDblClick:function(e,t,n,o,i,d,a,r){var l=this.getView().up("documentmain"),s=Ext.create("Tel100.model.document.Base",{id:o.get("related_id")});s.load({success:function(e){l.getController().openDocument(s)}})}}),Ext.define("Tel100.view.document.relation.PanelViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.documentrelationpanel",data:{relationCount:0,editable:!1},stores:{relations:{listeners:{load:function(){this.viewModel.set("relationCount",this.getTotalCount())}},autoLoad:!0,model:"Tel100.model.document.Base",proxy:{type:"ajax",extraParams:{base_id:"{document.id}"},url:"/api/documents/relations",reader:{type:"json"}}}},formulas:{notEditable:function(e){return!e("editable")}}}),Ext.define("Tel100.view.document.motions.AssigneeAddDialog",{extend:"Ext.window.Window",alias:"widget.documentmotionsassigneeadddialog",controller:"documentmotionsassigneeadddialog",viewModel:{type:"documentmotionsassigneeadddialog"},height:450,width:850,layout:"border",maximizable:!0,bind:{title:"{i18n.document.motion.add_assignees}"},items:[{xtype:"gridpanel",region:"west",split:!0,itemId:"grid-in",width:200,bind:{selection:"{selection}",store:"{incoming}"},columns:[{xtype:"gridcolumn",resizable:!1,sortable:!1,dataIndex:"html_text",hideable:!1,flex:1,bind:{text:"{i18n.document.motion.incoming}"}}]},{xtype:"gridpanel",region:"center",itemId:"grid-out",bodyBorder:!1,bind:{selection:"{outSelection}",store:"{outgoing}"},columns:[{xtype:"gridcolumn",renderer:function(e,t,n,o,i,d,a){return helpers.document.status.motionStatusIcon(e,n)},resizable:!1,width:28,sortable:!1,dataIndex:"status",hideable:!1},{xtype:"gridcolumn",width:180,sortable:!1,dataIndex:"receiverName",hideable:!1,bind:{text:"{i18n.document.motion.receiver}"}},{xtype:"gridcolumn",renderer:function(e,t,n,o,i,d,a){return n.get("send_type_name")},sortable:!1,dataIndex:"send_type_id",hideable:!1,bind:{text:"{i18n.document.motion.send_type}"},editor:{xtype:"combobox",editable:!1,displayField:"html_name",valueField:"id",bind:{store:"{responseTypes}"}}},{xtype:"gridcolumn",width:200,sortable:!1,dataIndex:"motion_text",hideable:!1,bind:{text:"{i18n.document.motion.motion_text}"},editor:{xtype:"textfield"}},{xtype:"gridcolumn",sortable:!1,dataIndex:"due_date",formatter:'date("d/m/Y")',hideable:!1,bind:{text:"{i18n.document.motion.due_date}"},editor:{xtype:"datefield",format:"d/m/Y"}}],viewConfig:{getRowClass:function(e,t,n,o){var i=e.get("status");return helpers.document.status.motionStatusRowClass(i,e)}},plugins:[{ptype:"cellediting",clicksToEdit:1}],listeners:{beforecellcontextmenu:"showOutMotionsContextMenu"}}],listeners:{beforerender:"onWindowBeforeRender",motionchange:"onOutgoingMotionChange"},dockedItems:[{xtype:"toolbar",flex:1,dock:"bottom",autoScroll:!0,items:[{xtype:"button",handler:function(e,t){var n=this.up("documentmotionsassigneeadddialog"),o=helpers.party.getPartyDialog(function(e){n.getController().addReceivers(e)});o.show()},bind:{text:"{i18n.document.motion.actions.add_assignee}"}},{xtype:"tbspacer",flex:1},{xtype:"button",handler:function(e,t){var n=this.up("documentmotionsassigneeadddialog"),o=n.getViewModel(),i=o.get("document"),d=i.id;helpers.api.document.motion.sendDraft(d,null,{success:function(){n.fireEvent("motionssent",!0),n.close()}})},bind:{text:"{i18n.document.motion.actions.send_assigness}"}}]}],setDocument:function(e){var t=this.getViewModel();t.set("document",e)},getDocument:function(){var e=this.getViewModel();return e.get("document")},refreshOutgrid:function(){this.down("#grid-out").getStore().load()}}),Ext.define("Tel100.view.document.motions.AssigneeAddDialogViewController",{extend:"Ext.app.ViewController",alias:"controller.documentmotionsassigneeadddialog",addReceivers:function(e){var t=this;if(e){for(var n=[],o=0;o<e.length;o++){var i=function(e){return function(n){t.addReceiver(e,n)}}(e[o]);n.push(i)}async.series(n)}},addReceiver:function(e,t){var n=this.getView(),o=this.getViewModel(),i=e.get("ext_type"),d=o.get("document"),a=o.get("parentId"),r=n.down("#grid-out");helpers.api.document.motion.createDraft({params:{document_id:d.id,parent_id:a,receiver_id:e.id,receiver_type:i,receiver_role:"assignee"},success:function(e){var o=Ext.create("Tel100.model.document.Motion",e),i=r.getStore();i.add(o),n.fireEvent("datachanged",n,"add",o),t&&t(null,o)}.bind(this),failure:function(e){console.error(e)}.bind(this)})},showOutMotionsContextMenu:function(e,t,n,o,i,d,a,r){if(o&&o.get("status")===helpers.document.status.DRAFT){var l=this,s=l.getView(),c=Ext.create("Ext.menu.Menu",{items:[{text:i18n.document.motion.actions.delete_assignee,icon:"/images/delete.png",handler:function(){var e=(l.getViewModel(),s.down("#grid-out"));helpers.api.document.motion.deleteDraft(o.id,{success:function(){e.getStore().remove(o),s.fireEvent("datachanged",s,"delete")}})}}]});a.stopEvent(),c.showAt(a.getXY())}},onWindowBeforeRender:function(e,t){var n=(this.getView(),this.getViewModel()),o=function(e,t,n){e&&this.getView().fireEvent("motionchange",e)},i={deep:!0};n.bind("{outSelection}",o,this,i)},onOutgoingMotionChange:function(e){if(e.dirty){var t=this.getView(),n=e.getChanges();helpers.api.document.motion.updateDraft(e.id,{params:n,success:function(){e.commit(),t.fireEvent("datachanged",t,"update",e),n.send_type_id&&t.refreshOutgrid()}.bind(this),failure:function(t){e.reject(),console.error(t)}})}},onStoreLoad:function(e,t,n,o){var i=this.getViewModel();i.set("selection",t[0])}}),Ext.define("Tel100.view.document.motions.AssigneeAddDialogViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.documentmotionsassigneeadddialog",data:{document:null,selection:null,outSelection:null},stores:{incoming:{autoLoad:!0,model:"Tel100.model.document.Motion",proxy:{type:"ajax",extraParams:{document_id:"{document.id}",mode:"in"},url:"/api/documents/motion",reader:{type:"json"}},listeners:{load:"onStoreLoad"}},outgoing:{autoLoad:!0,model:"Tel100.model.document.Motion",proxy:{type:"ajax",extraParams:{document_id:"{document.id}",parent_id:"{selection.id}"},url:"/api/documents/motion/assignees_out",reader:{type:"json"}},filters:{property:"parent_id",value:"{parentId}"}},responseTypes:{autoLoad:!0,model:"Tel100.model.document.ResponseType",proxy:{type:"ajax",extraParams:{type:"send",role:"assignee"},url:"/api/documents/response_types",reader:{type:"json"}}}},formulas:{parentId:function(e){var t=e("selection.id");return"number"==typeof t?t:null}}}),Ext.define("Tel100.view.document.motions.AssigneePanel",{extend:"Ext.panel.Panel",alias:"widget.documentmotionsassigneepanel",controller:"documentmotionsassigneepanel",viewModel:{type:"documentmotionsassigneepanel"},layout:"fit",defaultListenerScope:!0,bind:{title:"{i18n.document.motion.assignees} ({assigneeCount})"},items:[{xtype:"gridpanel",bind:{selection:"{selection}",store:"{motions}"},viewConfig:{getRowClass:function(e,t,n,o){var i=e.get("status");return helpers.document.status.motionStatusRowClass(i,e)}},columns:[{xtype:"gridcolumn",renderer:function(e,t,n,o,i,d,a){return helpers.document.status.motionStatusIcon(e,n)},draggable:!1,resizable:!1,width:32,sortable:!1,dataIndex:"status",hideable:!1,text:""},{xtype:"gridcolumn",renderer:function(e,t,n,o,i,d,a){return helpers.document.status.motionReceiverName(e,n)},draggable:!1,width:200,sortable:!1,dataIndex:"receiverName",hideable:!1,bind:{text:"{i18n.document.motion.receiver}"}},{xtype:"gridcolumn",renderer:function(e,t,n,o,i,d,a){return n.get("send_type_name")},defaultWidth:150,sortable:!1,dataIndex:"send_type_id",hideable:!1,bind:{text:"{i18n.document.motion.send_type}"},editor:{xtype:"combobox",editable:!1,displayField:"name",valueField:"id",bind:{store:"{responseTypes}"}}},{xtype:"gridcolumn",draggable:!1,width:200,sortable:!1,dataIndex:"motion_text",hideable:!1,bind:{text:"{i18n.document.motion.motion_text}"},editor:{xtype:"textfield"}},{xtype:"gridcolumn",draggable:!1,width:100,sortable:!1,dataIndex:"due_date",formatter:'date("d/m/Y")',hideable:!1,bind:{text:"{i18n.document.motion.due_date}"},editor:{xtype:"datefield",format:"d/m/Y"}}],listeners:{beforeitemcontextmenu:"onGridBeforeItemContextMenu"},plugins:[{ptype:"cellediting",clicksToEdit:1}]}],tools:[{xtype:"tool",type:"refresh",listeners:{click:"onRefreshToolClick"}},{xtype:"tool",type:"plus",listeners:{click:"onAddToolClick"}}],listeners:{beforerender:{fn:"onBeforeRender",scope:"controller"}},onGridBeforeItemContextMenu:function(e,t,n,o,i,d){if(t.get("status")===helpers.document.status.DRAFT){var a=Ext.create("Ext.menu.Menu",{items:[{text:i18n.document.motion.actions.delete_assignee,icon:"/images/delete.png",handler:function(){var t=e.up("documentmotionsassigneepanel");t.deleteItemAt(o)}}]});i.stopEvent(),a.showAt(i.getXY())}},onRefreshToolClick:function(e,t,n,o){this.refresh()},onAddToolClick:function(e,t,n,o){var i=this,d=helpers.party.getPartyDialog(function(e){i.getController().addReceivers(e)});d.show()},refresh:function(){var e=this.getViewModel();e.getStore("motions").load()},initComponent:function(){this.callParent();var e=this,t=this.getViewModel();t.bind("{motions}",function(n){n&&(n.view=e,n.viewModel=t)})},getGrid:function(){return this.down("gridpanel")},deleteItemAt:function(e){var t=this,n=t.getViewModel().getStore("motions"),o=n.getAt(e);helpers.api.document.motion.deleteDraft(o.id,{success:function(){t.refresh(),t.fireEvent("datachanged",t,"delete")}})}}),Ext.define("Tel100.view.document.motions.AssigneePanelViewController",{extend:"Ext.app.ViewController",alias:"controller.documentmotionsassigneepanel",addReceiver:function(e,t){var n=this.getView(),o=n.getGrid(),i=this.getViewModel(),d=e.get("ext_type"),a=i.get("document");helpers.api.document.motion.createDraft({params:{document_id:a.id,parent_id:null,receiver_id:e.id,receiver_type:d,receiver_role:"assignee"},success:function(e){var i=Ext.create("Tel100.model.document.Motion",e),d=o.getStore();d.add(i),n.fireEvent("datachanged",n,"add",i),t&&t(null,i)}.bind(this),failure:function(e){console.error(e)}.bind(this)})},addReceivers:function(e){var t=this;if(e){for(var n=[],o=0;o<e.length;o++){var i=function(e){return function(n){t.addReceiver(e,n)}}(e[o]);n.push(i)}async.series(n)}},onBeforeRender:function(e,t){var n=this.getView(),o=this.getViewModel(),i=function(e,t,o){if(e&&e.dirty){var i=e,d=i.getChanges();helpers.api.document.motion.updateDraft(i.id,{params:d,success:function(){i.commit(),n.fireEvent("datachanged",n,"update",i),d.send_type_id&&n.refresh()}.bind(this),failure:function(e){i.reject(),console.error(e)}})}};o.bind("{selection}",i,this,{deep:!0})}}),Ext.define("Tel100.view.document.motions.AssigneePanelViewController1",{extend:"Ext.app.ViewController",alias:"controller.documentmotionssigneepanel",addReceiver:function(e,t){var n=this.getView(),o=n.getGrid(),i=this.getViewModel(),d=e.get("ext_type"),a=i.get("document");helpers.api.document.motion.createDraft({params:{document_id:a.id,parent_id:null,receiver_id:e.id,receiver_type:d,receiver_role:"signee"},success:function(e){var i=Ext.create("Tel100.model.document.Motion",e),d=o.getStore();d.add(i),n.fireEvent("datachanged",n,"add",i),t&&t(null,i)}.bind(this),failure:function(e){console.error(e)}.bind(this)})},addReceivers:function(e){var t=this;if(e){for(var n=[],o=0;o<e.length;o++){var i=function(e){return function(n){t.addReceiver(e,n)}}(e[o]);n.push(i)}async.series(n)}},onBeforeRender:function(e,t){var n=this.getView(),o=this.getViewModel(),i=function(e,t,o){if(e&&e.dirty){var i=e,d=i.getChanges();helpers.api.document.motion.updateDraft(i.id,{params:d,success:function(){i.commit(),n.fireEvent("datachanged",n,"update",i),d.send_type_id&&n.refresh()}.bind(this),failure:function(e){i.reject(),console.error(e)}})}};o.bind("{selection}",i,this,{deep:!0})}}),Ext.define("Tel100.view.document.motions.AssigneePanelViewController2",{extend:"Ext.app.ViewController",alias:"controller.documentmotionsauthorpanel",addReceiver:function(e,t){var n=this.getView(),o=n.getGrid(),i=this.getViewModel(),d=e.get("ext_type"),a=i.get("document");helpers.api.document.motion.createDraft({params:{document_id:a.id,parent_id:null,receiver_id:e.id,receiver_type:d,receiver_role:"author"},success:function(e){var i=Ext.create("Tel100.model.document.Motion",e),d=o.getStore();d.add(i),n.fireEvent("datachanged",n,"add",i),t&&t(null,i)}.bind(this),failure:function(e){console.error(e)}.bind(this)})},addReceivers:function(e){var t=this;if(e){for(var n=[],o=0;o<e.length;o++){var i=function(e){return function(n){t.addReceiver(e,n)}}(e[o]);n.push(i)}async.series(n)}},onBeforeRender:function(e,t){var n=this.getView(),o=this.getViewModel(),i=function(e,t,o){if(e&&e.dirty){var i=e,d=i.getChanges();helpers.api.document.motion.updateDraft(i.id,{params:d,success:function(){i.commit(),n.fireEvent("datachanged",n,"update",i),d.send_type_id&&n.refresh()}.bind(this),failure:function(e){i.reject(),console.error(e)}})}};o.bind("{selection}",i,this,{deep:!0})}}),Ext.define("Tel100.view.document.motions.AssigneePanelViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.documentmotionsassigneepanel",data:{assigneeCount:0,selection:null},stores:{motions:{onStoreChanges:function(){var e=this;this.viewModel.set("assigneeCount",e.getCount()),this.view.fireEvent("listchanged",e)},listeners:{datachanged:function(){this.onStoreChanges()}},autoLoad:!0,model:"Tel100.model.document.Motion",proxy:{type:"ajax",extraParams:{mode:"out",role:"assignee",document_id:"{document.id}"},url:"/api/documents/motion",reader:{type:"json"}}},responseTypes:{autoLoad:!0,model:"Tel100.model.document.ResponseType",proxy:{type:"ajax",extraParams:{type:"send",role:"assignee"},url:"/api/documents/response_types",reader:{type:"json"}}}}}),Ext.define("Tel100.view.document.motions.AssigneePanelViewModel1",{extend:"Ext.app.ViewModel",alias:"viewmodel.documentmotionssigneepanel",data:{assigneeCount:0,selection:null},stores:{motions:{onStoreChanges:function(){var e=this;this.viewModel.set("assigneeCount",e.getCount()),this.view.fireEvent("listchanged",e)},listeners:{datachanged:function(){this.onStoreChanges()}},autoLoad:!0,model:"Tel100.model.document.Motion",proxy:{type:"ajax",extraParams:{mode:"out",role:"signee",document_id:"{document.id}"},url:"/api/documents/motion",reader:{type:"json"}}}}}),Ext.define("Tel100.view.document.motions.AssigneePanelViewModel2",{extend:"Ext.app.ViewModel",alias:"viewmodel.documentmotionsauthorpanel",data:{assigneeCount:0,selection:null},stores:{motions:{onStoreChanges:function(){var e=this;this.viewModel.set("assigneeCount",e.getCount()),this.view.fireEvent("listchanged",e)},listeners:{datachanged:function(){this.onStoreChanges()}},autoLoad:!0,model:"Tel100.model.document.Motion",proxy:{type:"ajax",extraParams:{mode:"out",role:"author",document_id:"{document.id}"},url:"/api/documents/motion",reader:{type:"json"}}},responseTypes:{autoLoad:!0,model:"Tel100.model.document.ResponseType",proxy:{type:"ajax",extraParams:{type:"send"},url:"/api/documents/response_types",reader:{type:"json"}}}}}),Ext.define("Tel100.view.document.motions.AuthorPanel",{extend:"Ext.panel.Panel",alias:"widget.documentmotionsauthorpanel",controller:"documentmotionsauthorpanel",viewModel:{type:"documentmotionsauthorpanel"},layout:"fit",defaultListenerScope:!0,bind:{title:"{i18n.document.motion.authors} ({assigneeCount})"},items:[{xtype:"gridpanel",bind:{selection:"{selection}",store:"{motions}"},viewConfig:{getRowClass:function(e,t,n,o){var i=e.get("status");return helpers.document.status.motionStatusRowClass(i,e)}},columns:[{xtype:"gridcolumn",renderer:function(e,t,n,o,i,d,a){return helpers.document.status.motionStatusIcon(e,n)},draggable:!1,resizable:!1,width:32,sortable:!1,dataIndex:"status",hideable:!1,text:""},{xtype:"gridcolumn",renderer:function(e,t,n,o,i,d,a){return helpers.document.status.motionReceiverName(e,n)},draggable:!1,width:200,sortable:!1,dataIndex:"receiverName",hideable:!1,bind:{text:"{i18n.document.motion.receiver}"}},{xtype:"gridcolumn",draggable:!1,width:200,sortable:!1,dataIndex:"motion_text",hideable:!1,bind:{text:"{i18n.document.motion.motion_text}"},editor:{xtype:"textfield"}},{xtype:"gridcolumn",draggable:!1,width:100,sortable:!1,dataIndex:"due_date",formatter:'date("d/m/Y")',hideable:!1,bind:{text:"{i18n.document.motion.due_date}"},editor:{xtype:"datefield",format:"d/m/Y"}}],listeners:{beforeitemcontextmenu:"onGridBeforeItemContextMenu"},plugins:[{ptype:"cellediting",clicksToEdit:1}]}],tools:[{xtype:"tool",type:"refresh",listeners:{click:"onRefreshToolClick"}},{xtype:"tool",type:"plus",listeners:{click:"onAddToolClick"}}],listeners:{beforerender:{fn:"onBeforeRender",scope:"controller"}},onGridBeforeItemContextMenu:function(e,t,n,o,i,d){if(t.get("status")===helpers.document.status.DRAFT){var a=Ext.create("Ext.menu.Menu",{items:[{text:i18n.document.motion.actions.delete_author,icon:"/images/delete.png",handler:function(){var t=e.up("documentmotionsauthorpanel");t.deleteItemAt(o)}}]});i.stopEvent(),a.showAt(i.getXY())}},onRefreshToolClick:function(e,t,n,o){this.refresh()},onAddToolClick:function(e,t,n,o){var i=this,d=helpers.party.getPartyDialog(function(e){i.getController().addReceivers(e)});d.show()},refresh:function(){var e=this.getViewModel();e.getStore("motions").load()},initComponent:function(){this.callParent();var e=this,t=this.getViewModel();t.bind("{motions}",function(n){n&&(n.view=e,n.viewModel=t)})},getGrid:function(){return this.down("gridpanel")},deleteItemAt:function(e){var t=this,n=t.getViewModel().getStore("motions"),o=n.getAt(e);helpers.api.document.motion.deleteDraft(o.id,{success:function(){t.refresh(),t.fireEvent("datachanged",t,"delete")}})}}),Ext.define("Tel100.view.document.motions.InGrid",{extend:"Ext.grid.Panel",alias:"widget.documentmotionsingrid",config:{selection:null},viewModel:{type:"documentmotionsingrid"},publishes:["selection"],bodyBorder:!1,bind:{selection:"{selection}",store:"{motions}"},columns:[{xtype:"gridcolumn",renderer:function(e,t,n,o,i,d,a){return helpers.document.status.motionStatusIcon(e,n)},draggable:!1,width:28,sortable:!1,dataIndex:"status",emptyCellText:"",hideable:!1},{xtype:"gridcolumn",renderer:function(e,t,n,o,i,d,a){if("motion"===n.get("type"))return e;var r=this.getViewModel(),l=r.get("document"),s=l.get("docnumber"),c=l.get("sender_name");return"<strong>#"+s+"</strong>: "+c},draggable:!1,width:200,sortable:!1,dataIndex:"senderName",hideable:!1,bind:{text:"{i18n.document.motion.sender}"}},{xtype:"gridcolumn",draggable:!1,width:200,sortable:!1,dataIndex:"motion_text",hideable:!1,bind:{text:"{i18n.document.motion.motion_text}"}},{xtype:"gridcolumn",draggable:!1,width:100,sortable:!1,dataIndex:"due_date",formatter:'date("d/m/Y")',hideable:!1,bind:{text:"{i18n.document.motion.due_date}"}}],viewConfig:{getRowClass:function(e,t,n,o){var i=e.get("status");return helpers.document.status.motionStatusRowClass(i,e)}},refresh:function(){var e=this;e.setLoading(!0),this.getStore().load({callback:function(){e.setLoading(!1)}})},initComponent:function(){this.callParent();var e=this,t=this.getViewModel();t.bind("{selection}",function(n){t.set("activeMotion",e.getActiveMotion())}),t.bind("{motions}",function(n){n.on("load",function(){t.set("activeMotion",e.getActiveMotion({store:n}))})})},getActiveMotion:function(e){var t=this.getViewModel(),n=t.get("selection");if(n)return n;var o=e&&e.store||this.getStore();return o&&o.getCount()>0?o.getAt(0):null}}),Ext.define("Tel100.view.document.motions.InGridViewController",{extend:"Ext.app.ViewController",alias:"controller.documentmotionsingrid"}),Ext.define("Tel100.view.document.motions.InGridViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.documentmotionsingrid",data:{selection:null,activeMotion:null},stores:{motions:{autoLoad:!0,model:"Tel100.model.document.Motion",proxy:{type:"ajax",extraParams:{mode:"in",document_id:"{document.id}"},url:"/api/documents/motion",reader:{type:"json"}}}}}),Ext.define("Tel100.view.document.motions.InPanel",{extend:"Ext.panel.Panel",alias:"widget.documentmotionsinpanel",viewModel:{type:"documentmotionsinpanel"},border:!1,layout:"fit",bodyBorder:!1,bind:{title:"{i18n.document.motion.inMotions}"},dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",handler:function(e,t){var n=this.up("documentmotionsinpanel"),o=n.down("documentmotionsingrid");o.refresh()},bind:{text:"{i18n.ui.refresh}"}}]}],items:[{xtype:"documentmotionsingrid"}],initComponent:function(){this.callParent();var e=this,t=this.down("documentmotionsingrid"),n=t.getViewModel();n.bind("{activeMotion}",function(t){e.fireEvent("motionchanged",t)})},getActiveMotion:function(){var e=this.down("documentmotionsingrid");return e.getActiveMotion()}}),Ext.define("Tel100.view.document.motions.InPanelViewController",{extend:"Ext.app.ViewController",alias:"controller.documentmotionsinpanel"}),Ext.define("Tel100.view.document.motions.InPanelViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.documentmotionsinpanel",data:{selection:null}}),Ext.define("Tel100.view.document.motions.MotionQuickView",{extend:"Ext.container.Container",alias:"widget.documentmotionsmotionquickview",viewModel:{type:"documentmotionsmotionquickview"},autoScroll:!0,layout:"form",items:[{xtype:"displayfield",shrinkWrap:2,style:"height: inherit",bind:{value:"{sender}"}},{xtype:"displayfield",shrinkWrap:2,style:"height: inherit",bind:{value:"{receiver}"}}],getMotion:function(){this.getViewModel().get("motion")},setMotion:function(e){this.getViewModel().set("motion",e)}}),Ext.define("Tel100.view.document.motions.MotionQuickViewViewController",{extend:"Ext.app.ViewController",alias:"controller.documentmotionsmotionquickview"}),Ext.define("Tel100.view.document.motions.MotionQuickViewViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.documentmotionsmotionquickview",data:"motion: null",formulas:{sender:function(e){var t=e("motion.type"),n=e("motion.status");if("motion"===t){var o=e("motion.sender"),i=e("motion.send_type"),d=e("motion.received_at");return["<strong>"+o+"</strong>, ",'<span class="text-muted">'+i+"</span> ",'<span class="text-danger">'+d+"</span>"].join("")}var a=e("document"),n=a.get("status"),o=a.get("sender_name"),r=a.get("docnumber"),l=helpers.document.status.statusDecoration(n),s=a.get("sent_at_f");return['<span class="'+l.style+'">','<i class="fa '+l.icon+'"></i> ',"#<strong>"+r+"</strong> ",o+" ",'<span class="text-danger">'+(s||"")+"</span>","</span>"].join("")},receiver:function(e){var t=e("motion.type"),n=e("motion.status");if("motion"===t){var o=helpers.document.status.statusDecoration(n),i=e("motion.receiver"),d=e("motion.response_type"),a=e("motion.completed_at");return['<span class="'+o.style+'">','<i class="fa '+o.icon+'"></i> ',"<strong>"+i+"</strong>",a?', <span class="text-muted">'+d+"</span> ":"",'<span class="text-danger">'+(a||"")+"</span>","</span>"].join("")}return""}}}),Ext.define("Tel100.view.document.motions.OutGrid",{extend:"Ext.grid.Panel",alias:"widget.documentmotionsoutgrid",config:{hasDraftMotion:!1},viewModel:{type:"documentmotionsoutgrid"},publishes:["selection","hasDraftMotion"],bind:{store:"{motions}"},columns:[{xtype:"gridcolumn",renderer:function(e,t,n,o,i,d,a){return helpers.document.status.motionStatusIcon(e,n)},resizable:!1,width:28,sortable:!1,dataIndex:"status",hideable:!1},{xtype:"gridcolumn",width:48,sortable:!1,align:"right",dataIndex:"ordering",hideable:!1,bind:{text:"{i18n.document.motion.orderingShort}"},editor:{xtype:"numberfield",decimalPrecision:0,maxValue:999,minValue:1}},{xtype:"gridcolumn",
renderer:function(e,t,n,o,i,d,a){var r=n.get("receiver");return r&&"hr.Organization"==r.ext_type?'<i class="fa fa-bank"></i> '+e:'<i class="fa fa-user"></i> '+e},width:200,sortable:!1,dataIndex:"receiverName",hideable:!1,bind:{text:"{i18n.document.motion.receiver}"}},{xtype:"gridcolumn",renderer:function(e,t,n,o,i,d,a){return i18n.document.role[e]},width:110,sortable:!1,dataIndex:"receiver_role",hideable:!1,bind:{text:"{i18n.document.motion.receiver_role}"},editor:{xtype:"combobox",editable:!1,displayField:"localeField",valueField:"name",bind:{store:"{roles}"}}},{xtype:"gridcolumn",renderer:function(e,t,n,o,i,d,a){return n.get("send_type_name")},width:150,sortable:!1,dataIndex:"send_type_id",hideable:!1,bind:{text:"{i18n.document.motion.send_type}"},editor:{xtype:"combobox",editable:!1,displayField:"html_name",valueField:"id",bind:{store:"{responseTypes}"}}},{xtype:"gridcolumn",width:200,sortable:!1,dataIndex:"motion_text",hideable:!1,bind:{text:"{i18n.document.motion.motion_text}"},editor:{xtype:"textfield"}},{xtype:"gridcolumn",width:100,sortable:!1,dataIndex:"due_date",formatter:'date("d/m/Y")',hideable:!1,bind:{text:"{i18n.document.motion.due_date}"},editor:{xtype:"datefield",altFormats:"",format:"d/m/Y"}}],viewConfig:{getRowClass:function(e,t,n,o){var i=e.get("status");return helpers.document.status.motionStatusRowClass(i,e)}},plugins:[{ptype:"cellediting",clicksToEdit:1}],refresh:function(){var e=this.getViewModel(),t=e.get("parentId"),n=this.getStore();if(!n.isEmptyStore){var o=this;o.setLoading(!0),n.load({params:{parent_id:t},callback:function(){o.setLoading(!1)}})}},initComponent:function(){this.callParent();var e=this.getViewModel();e.bind("{motions}",function(e){e&&(e.viewModel=this)})}}),Ext.define("Tel100.view.document.motions.OutGridViewController",{extend:"Ext.app.ViewController",alias:"controller.documentmotionsoutgrid"}),Ext.define("Tel100.view.document.motions.OutGridViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.documentmotionsoutgrid",data:{parentId:null},stores:{motions:{onStoreChanges:function(){for(var e=!1,t=0;t<this.getCount();t++){var n=this.getAt(t);if(n.get("status")===helpers.document.status.DRAFT){e=!0;break}}this.viewModel&&this.viewModel.set("hasDraftMotion",e)},listeners:{update:function(){this.onStoreChanges()},remove:function(){this.onStoreChanges()},datachanged:function(){this.onStoreChanges()}},autoLoad:!0,model:"Tel100.model.document.Motion",proxy:{type:"ajax",extraParams:{mode:"out",document_id:"{document.id}"},url:"/api/documents/motion",reader:{type:"json"}}},roles:{data:[{name:"assignee"},{name:"signee"},{name:"author"}],fields:[{name:"name"},{calculate:function(e){return i18n.document.role[e.name]},name:"localeField"}]},responseTypes:{autoLoad:!0,model:"Tel100.model.document.ResponseType",proxy:{type:"ajax",extraParams:{type:"send"},url:"/api/documents/response_types",reader:{type:"json"}}}}}),Ext.define("Tel100.view.document.motions.OutPanel",{extend:"Ext.panel.Panel",alias:"widget.documentmotionsoutpanel",controller:"documentmotionsoutpanel",viewModel:{type:"documentmotionsoutpanel"},layout:"border",defaultListenerScope:!0,bind:{title:"{i18n.document.base.ui.motionsTabTitle}"},dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",handler:function(e,t){var n=this.up("documentmotionsoutpanel");n.refresh()},bind:{text:"{i18n.ui.refresh}",tooltip:"{i18n.ui.refresh}"}},{xtype:"button",handler:function(e,t){var n=this.up("documentmotionsoutpanel"),o=helpers.party.getPartyDialog(function(e){n.getController().addReceivers(e)});o.show()},cls:"success-button",bind:{text:"{i18n.ui.add_short}",tooltip:"{i18n.ui.add}"}},{xtype:"button",handler:function(e,t){var n=this.up("documentmotionsoutpanel"),o=n.getViewModel();if(!o.get("sendButtonDisabled")){var i=i18n.ui.confirmTitle,d=i18n.document.motion.sendMotionsConfirm;Ext.Msg.confirm(i,d,function(e){if("yes"===e){var t=n.getParentId(),i=o.get("document"),d=i.id;helpers.api.document.motion.sendDraft(d,t,{success:function(){n.refresh()}})}})}},bind:{disabled:"{sendButtonDisabled}",hidden:"{sendButtonDisabled}",text:"{i18n.document.motion.sendMotions}"}},{xtype:"tbfill"},{xtype:"button",handler:function(e,t){var n=this.up("documentmotionsoutpanel"),o=n.getViewModel(),i=o.get("selection");if(i){var d=i18n.ui.destroyConfirm,a=i18n.ui.confirmTitle,r=n.down("documentmotionsoutgrid"),l=function(){r.getStore().remove(i),n.fireEvent("datachanged",n,"delete")};Ext.Msg.confirm(a,d,function(e){"yes"===e&&helpers.api.document.motion.deleteDraft(i.id,{success:l})}.bind(this))}},cls:"danger-button",bind:{disabled:"{deleteDraftButtonDisabled}",text:"{i18n.ui.destroy_short}",tooltip:"{i18n.ui.destroy}"}}]}],items:[{xtype:"documentmotionsoutgrid",data:{outmode:!0,basemotion:!1},region:"center",bind:{selection:"{selection}"}}],listeners:{beforerender:{fn:"onBeforeRender",scope:"controller"},motionchange:{fn:"onPanelMotionChange",scope:"controller"},beforedestroy:{fn:"onPanelBeforeDestroy",scope:"controller"},draftmotionchanged:"onDraftmotionChanged"},onDraftmotionChanged:function(e){var t=this.getViewModel();t.set("hasDraftMotions",e)},refresh:function(){this.getGrid().refresh()},getGrid:function(){return this.down("documentmotionsoutgrid")},initComponent:function(){this.callParent();var e=this.getGrid().getViewModel(),t=this;e.bind("{hasDraftMotion}",function(){var n=e.get("hasDraftMotion");t.fireEvent("draftmotionchanged",n)})},setParentId:function(e){var t=this.down("documentmotionsoutgrid"),n=t.getViewModel();n.set("parentId",e)},getParentId:function(){var e=this.down("documentmotionsoutgrid"),t=e.getViewModel();return t.get("parentId")}}),Ext.define("Tel100.view.document.motions.OutPanelViewController",{extend:"Ext.app.ViewController",alias:"controller.documentmotionsoutpanel",addReceiver:function(e){var t=(e.get("ext_type"),this.getViewModel().get("document")),n=this.getView().getGrid(),o=n.getViewModel().get("parentId");helpers.api.document.motion.createDraft({params:{document_id:t.id,receiver_id:e.id,receiver_role:"assignee",ordering:1,parent_id:o,receiver_type:e.get("ext_type")},success:function(e){var t=Ext.create("Tel100.model.document.Motion",e),n=this.getView(),o=n.down("documentmotionsoutgrid"),i=o.getStore();i.add(t),n.fireEvent("datachanged",n,"add",t)}.bind(this),failure:function(e){console.error(e)}.bind(this)})},addReceivers:function(e){if(e)for(var t=0;t<e.length;t++)this.addReceiver(e[t])},onBeforeRender:function(e,t){var n=(this.getView(),this.getViewModel()),o=function(e,t,n){e&&this.getView().fireEvent("motionchange",e)},i={deep:!0};n.bind("{selection}",o,this,i)},onPanelMotionChange:function(e){if(e.dirty){var t=this.getView(),n=e.getChanges();helpers.api.document.motion.updateDraft(e.id,{params:n,success:function(){e.commit(),t.fireEvent("datachanged",t,"update",e),n.send_type_id&&t.getGrid().refresh()}.bind(this),failure:function(t){e.reject(),console.error(t)}})}},onPanelBeforeDestroy:function(e,t){this.receiverDialog&&this.receiverDialog.destroy()}}),Ext.define("Tel100.view.document.motions.OutPanelViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.documentmotionsoutpanel",data:{motionbase:!0,selection:null},formulas:{deleteDraftButtonDisabled:function(e){var t=e("selection");if(t){var n=t.get("status");return n!==helpers.document.status.DRAFT}return!0},sendButtonDisabled:function(e){var t=e("document.status");return t===helpers.document.status.DRAFT?!0:!e("hasDraftMotions")}}}),Ext.define("Tel100.view.document.motions.Panel",{extend:"Ext.container.Container",alias:"widget.documentmotionspanel",viewModel:{type:"documentmotionspanel"},layout:"fit",items:[{xtype:"tabpanel",activeTab:0,items:[{xtype:"panel",autoScroll:!0,bodyPadding:5,layout:{type:"vbox",align:"stretch"},bind:{title:'<i class="fa fa-send"></i> {i18n.document.motion.general}'},items:[{xtype:"textfield",flex:0,readOnly:!0,bind:{fieldLabel:"{i18n.document.motion.sender}",value:"{motion.senderName}"}},{xtype:"textfield",flex:0,readOnly:!0,bind:{fieldLabel:"{i18n.document.motion.receiver}",value:"{motion.receiverName}"}},{xtype:"textfield",editable:!1,bind:{fieldLabel:"{i18n.document.motion.send_type}",value:"{motion.send_type_name}"}},{xtype:"textareafield",readOnly:!0,bind:{fieldLabel:"{i18n.document.motion.motion_text}",value:"{motion.motion_text}"}},{xtype:"datefield",readOnly:!0,format:"d/m/Y",bind:{fieldLabel:"{i18n.document.motion.due_date}",value:"{motion.due_date}"}},{xtype:"displayfield",renderer:function(e,t){var n=t.up("documentmotionspanel"),o=n.getViewModel(),i=o.get("motion"),d=i&&i.get("resp_type_name");return d?e+" - "+d:e},bind:{fieldLabel:"{i18n.document.motion.status}",value:"{motion.statusFull}"}},{xtype:"textareafield",readOnly:!0,bind:{fieldLabel:"{i18n.document.motion.response_text}",value:"{motion.response_text}"}}]},{xtype:"panel",autoScroll:!0,defaults:{labelWidth:150},bodyPadding:5,layout:{type:"vbox",align:"stretch"},bind:{title:'<i class="fa fa-calendar"></i> {i18n.document.motion.times}'},items:[{xtype:"datefield",readOnly:!0,format:"d/m/Y H:i:s",bind:{fieldLabel:'<i class="fa fa-circle-o"></i> {i18n.document.motion.created_at}',value:"{motion.created_at}"}},{xtype:"datefield",readOnly:!0,format:"d/m/Y H:i:s",bind:{fieldLabel:'<i class="fa fa-edit"></i> {i18n.document.motion.updated_at}',value:"{motion.updated_at}"}},{xtype:"label",height:25},{xtype:"datefield",readOnly:!0,format:"d/m/Y H:i:s",bind:{fieldLabel:'<i class="fa fa-send"></i> {i18n.document.motion.sent_at}',value:"{motion.sent_at}"}},{xtype:"datefield",readOnly:!0,format:"d/m/Y H:i:s",bind:{fieldLabel:'<i class="fa fa-clock-o"></i> {i18n.document.motion.received_at}',value:"{motion.received_at}"}},{xtype:"datefield",readOnly:!0,format:"d/m/Y H:i:s",bind:{fieldLabel:'<i class="fa fa-check"></i> {i18n.document.motion.completed_at}',value:"{motion.completed_at}"}}]}]}],setMotion:function(e){var t=this;Ext.create("Tel100.model.document.Motion",{id:e.id}).load({success:function(e,n){t.getViewModel().set("motion",e)},failure:function(e,t){console.log("cannot load motion")}})},getMotion:function(){return this.getViewModel().get("motion")}}),Ext.define("Tel100.view.document.motions.PanelViewController",{extend:"Ext.app.ViewController",alias:"controller.documentmotionspanel"}),Ext.define("Tel100.view.document.motions.PanelViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.documentmotionspanel",data:{motion:null}}),Ext.define("Tel100.view.document.motions.Properties",{extend:"Ext.window.Window",alias:"widget.documentmotionsproperties",viewModel:{type:"documentmotionsproperties"},height:390,width:550,layout:"fit",bind:{title:'<i class="fa fa-truck"></i> {i18n.document.motion.properties}'},items:[{xtype:"documentmotionspanel"}],getPanel:function(){return this.down("documentmotionspanel")},getMotion:function(){return this.getPanel().getMotion()},setMotion:function(e){this.getPanel().setMotion(e)}}),Ext.define("Tel100.view.document.motions.PropertiesViewController",{extend:"Ext.app.ViewController",alias:"controller.documentmotionsproperties"}),Ext.define("Tel100.view.document.motions.PropertiesViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.documentmotionsproperties"}),Ext.define("Tel100.view.document.motions.ReceiversPanel",{extend:"Ext.grid.Panel",alias:"widget.documentmotionsreceiverspanel",controller:"documentmotionsreceiverspanel",viewModel:{type:"documentmotionsreceiverspanel"},hideHeaders:!0,defaultListenerScope:!0,bind:{title:"{i18n.document.motion.receivers} ({receiverCount})",store:"{receivers}"},columns:[{xtype:"gridcolumn",renderer:function(e,t,n,o,i,d,a){return helpers.document.renderer.renderMotion(n,{as:"receiver"})},dataIndex:"name",text:"name",flex:1}],tools:[{xtype:"tool",type:"refresh",listeners:{click:"onRefresh"}},{xtype:"tool",type:"plus",listeners:{click:"onAddAssignee"}}],onRefresh:function(e,t,n,o){this.refresh()},onAddAssignee:function(e,t,n,o){var i=this,d=this.getViewModel(),a=Ext.create("Tel100.view.document.motions.AssigneeAddDialog",{modal:!0});a.setDocument(d.get("document")),a.show(),a.on("motionssent",function(){i.refresh(),d.get("document").load()})},onStoreLoad:function(e,t,n,o){var i=this.getViewModel();i.set("receiverCount",this.getStore().count())},refresh:function(){this.getStore().load()}}),Ext.define("Tel100.view.document.motions.ReceiversPanelViewController",{extend:"Ext.app.ViewController",alias:"controller.documentmotionsreceiverspanel",onStoreLoad:function(e,t,n,o){}}),Ext.define("Tel100.view.document.motions.ReceiversPanelViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.documentmotionsreceiverspanel",data:{receiverCount:0},stores:{receivers:{autoLoad:!0,model:"Tel100.model.document.Motion",proxy:{type:"ajax",extraParams:{document_id:"{document.id}"},url:"/api/documents/motion/assignees",reader:{type:"json"}},listeners:{load:"onStoreLoad"}}}}),Ext.define("Tel100.view.document.motions.ResultPanel",{extend:"Ext.panel.Panel",alias:"widget.documentmotionsresultpanel",controller:"documentmotionsresultpanel",viewModel:{type:"documentmotionsresultpanel"},autoScroll:!0,layout:{type:"vbox",align:"stretch",padding:5},bind:{title:"{i18n.document.motion.resultPaneTitle}"},items:[{xtype:"combobox",tpl:'<tpl for="."><div class="x-boundlist-item">{html_text}</div></tpl>',itemId:"in-motions",editable:!1,autoSelect:!1,valueField:"id",bind:{fieldLabel:"{i18n.document.comment.motion}",value:"{motionId}",store:"{motions}",selection:"{selection}"}},{xtype:"checkboxfield",flex:0,itemId:"is-complete",bind:{hidden:"{hideComplete}",fieldLabel:"{i18n.document.comment.complete}",value:"{isResult}"}},{xtype:"combobox",tpl:'<tpl for="."><div class="x-boundlist-item">{html_name}</div></tpl>',flex:0,itemId:"result-types",editable:!1,autoSelect:!1,displayField:"name",valueField:"id",bind:{hidden:"{hideResult}",fieldLabel:"{i18n.document.comment.result}",value:"{categoryId}",store:"{responseTypes}"}},{xtype:"textareafield",flex:0,itemId:"comment-text",bind:{fieldLabel:"{i18n.document.comment.text}",value:"{text}"}},{xtype:"button",margin:8,width:728,bind:{text:"{saveLabel}"},listeners:{click:"onSaveClick"}},{xtype:"documentrelationanswer",flex:1}],resetForm:function(){var e=this.down("#in-motions"),t=this.down("#result-types"),n=this.down("#is-complete"),o=this.down("#comment-text");e.getStore().load(),t.select(t.getStore().getAt(0)),o.setValue(""),n.setValue(!1)}}),Ext.define("Tel100.view.document.motions.ResultPanelViewController",{extend:"Ext.app.ViewController",alias:"controller.documentmotionsresultpanel",onSaveClick:function(e,t,n){var o=this.getView(),i=this.getViewModel(),d=i.get("document").id,a=i.get("selection.id");"number"!=typeof a&&(a=null);var r=i.get("text"),l=i.get("isResult");l&&i.get("hideComplete")&&(l=!1);var s=null;l&&(s=i.get("categoryId"));var c={document_id:d,motion_id:a,is_result:l,text:r,response_type_id:s};return c.is_result||c.text?(o.setLoading(!0),void helpers.api.document.comment.create({params:c,success:function(e){o.resetForm(),o.setLoading(!1),o.fireEvent("commentadded")},failure:function(e){o.setLoading(!1),console.error(e)}})):void Ext.Msg.show({title:i18n.document.comment.errors.text_required_title,message:i18n.document.comment.errors.text_required,buttons:Ext.Msg.OK})},onMotionsStoreLoad:function(e,t,n,o){var i=this.getView(),d=i.down("#in-motions"),a=e.getAt(0);d.select(a)},onResponseTypesStoreLoad:function(e,t,n,o){var i=this.getView(),d=i.down("#result-types"),a=e.getAt(0);d.select(a)}}),Ext.define("Tel100.view.document.motions.ResultPanelViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.documentmotionsresultpanel",data:{motionId:null,isResult:!1,categoryId:null,text:null,selection:null},stores:{motions:{autoLoad:!0,model:"Tel100.model.document.Motion",proxy:{type:"ajax",extraParams:{mode:"in",document_id:"{document.id}"},url:"/api/documents/motion",reader:{type:"json"}},listeners:{load:"onMotionsStoreLoad"}},responseTypes:{autoLoad:!0,model:"Tel100.model.document.ResponseType",filters:{property:"role",value:"{receiverRole}"},proxy:{type:"ajax",extraParams:{type:"response"},url:"/api/documents/response_types",reader:{type:"json"}},listeners:{load:"onResponseTypesStoreLoad"}}},formulas:{hideResult:function(e){return!e("isResult")},hideComplete:function(e){return e("selection.status")!==helpers.document.status.CURRENT},saveLabel:function(e){return e("isResult")?i18n.document.comment.actions.saveResult:i18n.document.comment.actions.saveComment},receiverRole:function(e){return e("selection.receiver_role")||"owner"}}}),Ext.define("Tel100.view.document.motions.SignaturesViewer",{extend:"Ext.grid.Panel",alias:"widget.documentmotionssignaturesviewer",controller:"documentmotionssignaturesviewer",viewModel:{type:"documentmotionssignaturesviewer"},hideHeaders:!0,defaultListenerScope:!0,bind:{title:"{i18n.document.motion.signatures} ({signatureCount})",store:"{signatures}"},columns:[{xtype:"gridcolumn",renderer:function(e,t,n,o,i,d,a){var r=n.get("status"),l=helpers.document.status.statusDecoration(r),s="<strong>"+e+"</strong>",c=n.get("role"),u=i18n.document.role[c];s+=', <span class="text-muted">'+u+"</span>";var m=n.get("date");return m&&(s=s+" &mdash; "+m),['<span class="'+l.style+'">','<i class="fa '+l.icon+'"></i> ',s,"</span>"].join("")},dataIndex:"name",text:"name",flex:1}],tools:[{xtype:"tool",type:"refresh",listeners:{click:"onRefresh"}}],onRefresh:function(e,t,n,o){this.refresh()},refresh:function(){this.getStore().load()},onStoreLoad:function(e,t,n,o){var i=this.getViewModel();i.set("signatureCount",e.count())}}),Ext.define("Tel100.view.document.motions.SignaturesViewerViewController",{extend:"Ext.app.ViewController",alias:"controller.documentmotionssignaturesviewer",onStoreLoad:function(e,t,n,o){}}),Ext.define("Tel100.view.document.motions.SignaturesViewerViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.documentmotionssignaturesviewer",data:{signatureCount:0},stores:{signatures:{autoLoad:!0,model:"Tel100.model.document.Motion",proxy:{type:"ajax",extraParams:{document_id:"{document.id}"},url:"/api/documents/motion/signatures",reader:{type:"json"}},listeners:{load:"onStoreLoad"}}}}),Ext.define("Tel100.view.document.motions.SigneePanel",{extend:"Ext.panel.Panel",alias:"widget.documentmotionssigneepanel",controller:"documentmotionssigneepanel",viewModel:{type:"documentmotionssigneepanel"},layout:"fit",defaultListenerScope:!0,bind:{title:"{i18n.document.motion.signees} ({assigneeCount})"},items:[{xtype:"gridpanel",bind:{selection:"{selection}",store:"{motions}"},viewConfig:{getRowClass:function(e,t,n,o){var i=e.get("status");return helpers.document.status.motionStatusRowClass(i,e)}},columns:[{xtype:"gridcolumn",renderer:function(e,t,n,o,i,d,a){return helpers.document.status.motionStatusIcon(e,n)},draggable:!1,resizable:!1,width:32,sortable:!1,dataIndex:"status",hideable:!1,text:""},{xtype:"gridcolumn",width:48,sortable:!1,align:"right",dataIndex:"ordering",hideable:!1,bind:{text:"{i18n.document.motion.orderingShort}"},editor:{xtype:"numberfield",maxValue:999,minValue:1}},{xtype:"gridcolumn",renderer:function(e,t,n,o,i,d,a){return helpers.document.status.motionReceiverName(e,n)},draggable:!1,width:200,sortable:!1,dataIndex:"receiverName",hideable:!1,bind:{text:"{i18n.document.motion.receiver}"}},{xtype:"gridcolumn",draggable:!1,width:200,sortable:!1,dataIndex:"motion_text",hideable:!1,bind:{text:"{i18n.document.motion.motion_text}"},editor:{xtype:"textfield"}},{xtype:"gridcolumn",draggable:!1,width:100,sortable:!1,dataIndex:"due_date",formatter:'date("d/m/Y")',hideable:!1,bind:{text:"{i18n.document.motion.due_date}"},editor:{xtype:"datefield",format:"d/m/Y"}}],listeners:{beforeitemcontextmenu:"onGridBeforeItemContextMenu"},plugins:[{ptype:"cellediting",clicksToEdit:1}]}],tools:[{xtype:"tool",type:"refresh",listeners:{click:"onRefreshToolClick"}},{xtype:"tool",type:"plus",listeners:{click:"onAddToolClick"}}],listeners:{beforerender:{fn:"onBeforeRender",scope:"controller"}},onGridBeforeItemContextMenu:function(e,t,n,o,i,d){if(t.get("status")===helpers.document.status.DRAFT){var a=Ext.create("Ext.menu.Menu",{items:[{text:i18n.document.motion.actions.delete_signee,icon:"/images/delete.png",handler:function(){var t=e.up("documentmotionssigneepanel");t.deleteItemAt(o)}}]});i.stopEvent(),a.showAt(i.getXY())}},onRefreshToolClick:function(e,t,n,o){this.refresh()},onAddToolClick:function(e,t,n,o){var i=this,d=helpers.party.getPartyDialog(function(e){i.getController().addReceivers(e)});d.show()},refresh:function(){var e=this.getViewModel();e.getStore("motions").load()},initComponent:function(){this.callParent();var e=this,t=this.getViewModel();t.bind("{motions}",function(n){n&&(n.view=e,n.viewModel=t)})},getGrid:function(){return this.down("gridpanel")},deleteItemAt:function(e){var t=this,n=t.getViewModel().getStore("motions"),o=n.getAt(e);helpers.api.document.motion.deleteDraft(o.id,{success:function(){t.refresh(),t.fireEvent("datachanged",t,"delete")}})}}),Ext.define("Tel100.view.document.motions.Tree",{extend:"Ext.tree.Panel",alias:"widget.documentmotionstree",config:{selection:null},viewModel:{type:"documentmotionstree"},border:!1,bodyBorder:!1,bodyCls:"x-tree-noicon",autoLoad:!0,enableColumnHide:!1,hideHeaders:!0,rowLines:!0,scroll:"vertical",lines:!1,useArrows:!0,defaultListenerScope:!0,bind:{selection:"{selection}",title:"{i18n.document.motion.tree}",store:"{motions}"},viewConfig:{},columns:[{xtype:"treecolumn",renderer:function(e,t,n,o,i,d,a){var r=function(e,t,n){var o,i=helpers.document.status.statusDecoration(e);return o=t&&e===helpers.document.status.CURRENT?'<i class="text-danger fa fa-circle"></i>':'<i class="fa '+i.icon+'"></i>','<span class="'+i.style+'"> '+o+" "+n+"</span>"};if(n.get("root")){var l=a.up("documentmotionstree"),s=l.getViewModel(),c=s.get("document"),u=c.get("status"),m=i18n.document.role.creator,p="#<strong>"+c.get("docnumber")+"</strong>: "+c.get("sender_name")+', <span class="text-muted">'+m+"</span>";return r(u,!1,p)}return helpers.document.renderer.renderMotion(n)},dataIndex:"receiver",text:"Receiver",flex:1}],tools:[{xtype:"tool",type:"refresh",listeners:{click:"onToolClick"}}],listeners:{beforecellcontextmenu:"onTreepanelBeforeCellContextMenu"},dockedItems:[{xtype:"documentmotionsmotionquickview",resizable:!0,style:"background-color: #dfeaf2;",dock:"bottom",bind:{motion:"{selection}",hidden:"{hideQuickProperties}"}}],onToolClick:function(e,t,n,o){this.refresh()},onTreepanelBeforeCellContextMenu:function(e,t,n,o,i,d,a,r){if("motion"===o.get("type")){var l=Ext.create("Ext.menu.Menu",{items:[{text:i18n.document.motion.properties,icon:"/images/properties.png",handler:function(){var e=helpers.document.motion.getPropertiesDialog(o);e.show()}}]});a.stopEvent(),l.showAt(a.getXY())}},refresh:function(){var e=this.getViewModel(),t=e.get("motions");t.load()}}),Ext.define("Tel100.view.document.motions.TreeViewController",{extend:"Ext.app.ViewController",alias:"controller.documentmotionstree"}),Ext.define("Tel100.view.document.motions.TreeViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.documentmotionstree",data:{selection:null},stores:{motions:{type:"tree",rootVisible:!0,root:{expanded:!0},proxy:{type:"ajax",extraParams:{document_id:"{document.id}"},url:"/api/documents/motion/tree",reader:{type:"json"}},fields:[{name:"id"},{name:"sender"},{name:"receiver"},{name:"status"},{name:"ordering"}]}},formulas:{disableProperties:function(e){return!e("selection")},hideQuickProperties:function(e){return!e("selection")}}}),Ext.define("Tel100.view.hr.party.Add",{extend:"Ext.window.Window",alias:"widget.hrpartyadd",config:{buttonAlign:"center"},controller:"hrpartyadd",viewModel:{type:"hrpartyadd"},resizable:!1,width:500,layout:"fit",modal:!0,bind:{title:"{i18n.hr.party.newparty}"},items:[{xtype:"form",buttonAlign:"center",bodyPadding:0,header:!1,title:"My Form",url:"/api/hr/party/create",layout:{type:"vbox",align:"stretch"},items:[{xtype:"tabpanel",activeTab:0,items:[{xtype:"panel",layout:"form",title:"KA",items:[{xtype:"textfield",name:"name_ka",allowBlank:!1,bind:{fieldLabel:"{i18n.hr.party.fields.name}"}},{xtype:"textfield",name:"address_ka",bind:{fieldLabel:"{i18n.hr.party.fields.address}"}},{xtype:"textfield",name:"contact_ka",bind:{fieldLabel:"{i18n.hr.party.fields.contact}"}}]},{xtype:"panel",layout:"form",title:"RU",items:[{xtype:"textfield",name:"name_ru",bind:{fieldLabel:"{i18n.hr.party.fields.name}"}},{xtype:"textfield",name:"address_ru",bind:{fieldLabel:"{i18n.hr.party.fields.address}"}},{xtype:"textfield",name:"contact_ru",bind:{fieldLabel:"{i18n.hr.party.fields.contact}"}}]},{xtype:"panel",layout:"form",title:"EN",items:[{xtype:"textfield",name:"name_en",bind:{fieldLabel:"{i18n.hr.party.fields.name}"}},{xtype:"textfield",name:"address_en",bind:{fieldLabel:"{i18n.hr.party.fields.address}"}},{xtype:"textfield",name:"contact_en",bind:{fieldLabel:"{i18n.hr.party.fields.contact}"}}]}]},{xtype:"container",layout:"form",items:[{xtype:"textfield",name:"identity",bind:{fieldLabel:"{i18n.hr.party.fields.identity}"}},{xtype:"textfield",name:"phones",bind:{fieldLabel:"{i18n.hr.party.fields.phones}"}},{xtype:"textfield",fieldLabel:"Email",name:"email"}]},{xtype:"button",margin:5,bind:{text:"{i18n.ui.save}"},listeners:{click:"onButtonClick"}}]}]}),Ext.define("Tel100.view.hr.party.AddViewController",{extend:"Ext.app.ViewController",alias:"controller.hrpartyadd",onButtonClick:function(e,t,n){this.getView().down("form").submit({success:function(e,t){Ext.Msg.alert("Success"),e.owner.up("window").close()},failure:function(e,t){Ext.Msg.alert("Error",t.result.error)}})}}),Ext.define("Tel100.view.hr.party.AddViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.hrpartyadd"}),Ext.define("Tel100.view.hr.party.Grid",{extend:"Ext.grid.Panel",alias:"widget.hrpartygrid",controller:"hrpartygrid",viewModel:{type:"hrpartygrid"},header:!1,defaultListenerScope:!0,bind:{title:"{i18n.hr.party.title}",store:"{party}"},columns:[{xtype:"numbercolumn",dataIndex:"identity",flex:1,format:"0000",bind:{text:"{i18n.hr.party.fields.identity}"}},{xtype:"gridcolumn",dataIndex:"name_ka",flex:1,bind:{text:"{i18n.hr.party.fields.name}"}},{xtype:"gridcolumn",dataIndex:"address_ka",flex:1,bind:{text:"{i18n.hr.party.fields.address}"}},{xtype:"gridcolumn",dataIndex:"phones",flex:1,bind:{text:"{i18n.hr.party.fields.phones}"}},{xtype:"gridcolumn",dataIndex:"email",text:"E-mail",flex:1},{xtype:"gridcolumn",dataIndex:"contact_ka",flex:1,bind:{text:"{i18n.hr.party.fields.contact}"}},{xtype:"gridcolumn",hidden:!0,dataIndex:"account",flex:1,bind:{text:"{i18n.hr.party.fields.account}"}}],dockedItems:[{xtype:"form",dock:"bottom",width:100,defaults:{anchor:"100%"},header:!1,title:"My Form",fieldDefaults:{labelAlign:"right"},layout:{type:"hbox",align:"stretch"},items:[{xtype:"container",flex:1,layout:"form",items:[{xtype:"textfield",name:"name",bind:{fieldLabel:"{i18n.hr.party.fields.name}"}},{xtype:"textfield",name:"identity",bind:{fieldLabel:"{i18n.hr.party.fields.identity}"}},{xtype:"textfield",name:"address",bind:{fieldLabel:"{i18n.hr.party.fields.address}"}},{xtype:"textfield",name:"contact",bind:{fieldLabel:"{i18n.hr.party.fields.contact}"}}]},{xtype:"container",layout:{type:"vbox",align:"stretch",padding:5},items:[{xtype:"button",flex:1,bind:{text:"{i18n.document.search.ui.search}"},listeners:{click:{fn:"onButtonClick1",scope:"controller"}}},{xtype:"button",flex:1,bind:{text:"{i18n.hr.party.add}"},listeners:{click:{fn:"onButtonClick",scope:"controller"}}}]}]}],listeners:{afterrender:"onGridpanelAfterRender"},onGridpanelAfterRender:function(e,t){e.addDocked(new Ext.PagingToolbar({displayInfo:!0,dock:"bottom",afterPageText:" / {0}",beforePageText:i18n.ui.page,emptyMsg:i18n.ui.emptyMsg,displayMsg:i18n.ui.displayMsg,bind:{store:"{party}"}}))}}),Ext.define("Tel100.view.hr.party.GridViewController",{extend:"Ext.app.ViewController",alias:"controller.hrpartygrid",onButtonClick1:function(e,t,n){var o=this.getView().down("form"),i=o.getValues();this.getStore("party").getProxy().setExtraParams(i);var d=this.getStore("party");d.removeAll(),d.currentPage=1,this.getStore("party").load()},onButtonClick:function(e,t,n){var o=Ext.create("Tel100.view.hr.party.Add",{title:i18n.document.motion.selectReceiver});o.show()}}),Ext.define("Tel100.view.hr.party.GridViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.hrpartygrid",stores:{party:{pageSize:10,model:"Tel100.model.hr.Party"}}}),Ext.define("Tel100.view.hr.tree.Panel",{extend:"Ext.tree.Panel",alias:"widget.hrtreepanel",controller:"hrtreepanel",viewModel:{type:"hrtreepanel"},bodyCls:"x-tree-noicon",autoLoad:!0,enableColumnHide:!1,hideHeaders:!0,rowLines:!0,lines:!1,rootVisible:!1,useArrows:!0,bind:{title:"{i18n.hr.tree.title}",store:"{structure}"},viewConfig:{},columns:[{xtype:"treecolumn",renderer:function(e,t,n,o,i,d,a){return n.toHtml?n.toHtml():'<i class="fa fa-bolt"></i> '+i18n.application.telasi},dataIndex:"name",flex:1}],listeners:{beforeload:"onTreepanelBeforeLoad",load:"onTreepanelLoad",afterrender:"onTreepanelAfterRender",startsearch:"onTreepanelStartsearch"},tools:[{xtype:"tool",type:"refresh",listeners:{click:"onRefresh"}}],dockedItems:[{xtype:"toolbar",dock:"bottom",items:[{xtype:"textfield",itemId:"searchField",fieldLabel:"Label",hideLabel:!0,listeners:{change:"onSearchFieldChange",specialkey:"onSearchFieldSpecialkey"}},{xtype:"button",text:'<i class="fa fa-search"></i>',listeners:{click:"onSearchButtonClick"}},{xtype:"button",disabled:!0,itemId:"nextbutton",text:'<i class="fa fa-forward"></i>',listeners:{click:"onNextSearchButtonClick"}}]}],refresh:function(){this.getStore("structure").load()}}),Ext.define("Tel100.view.hr.tree.PanelViewController",{extend:"Ext.app.ViewController",alias:"controller.hrtreepanel",searchAndExpand:function(e,t,n,o,i){var d=t.findChildBy(function(e){if(this.counter++,this.counter<=this.oldcounter)return!1;var t=e.get(o);return t?i(t,n):void 0},this,!0);d&&(this.oldcounter=this.counter,e.collapseAll(),e.expandPath(d.getPath()),e.getSelectionModel().select(d))},startSearch:function(){var e=this.getView(),t=e.down("textfield").getValue(),n=e.getRootNode();this.counter=0,this.oldcounter=0,this.searchAndExpand(e,n,t,"full_name",function(e,t){return-1!=e.indexOf(t)}),this.getView().down("#nextbutton").setDisabled(!1)},onTreepanelBeforeLoad:function(e,t,n){this.getView().setLoading(!0)},onTreepanelLoad:function(e,t,n,o,i,d){this.getView().setLoading(!1)},onRefresh:function(e,t,n,o){this.getView().refresh()},onSearchFieldChange:function(e,t,n,o){this.counter=0,this.oldcounter=0,this.getView().down("#nextbutton").setDisabled(!0)},onSearchFieldSpecialkey:function(e,t,n){t.getKey()==t.ENTER&&this.startSearch()},onSearchButtonClick:function(e,t,n){this.startSearch()},onNextSearchButtonClick:function(e,t,n){var o=this.getView(),i=o.getRootNode(),d=o.down("textfield").getValue();this.counter=0,this.oldcounter++,this.searchAndExpand(o,i,d,"full_name",function(e,t){return-1!=e.indexOf(t)})},onTreepanelAfterRender:function(e,t){helpers.party.vacationAction(e)},onTreepanelStartsearch:function(e,t){var n=e.getRootNode();this.counter=0,this.oldcounter=0,this.searchAndExpand(e,n,t,"id",function(e,t){return e==t})}}),Ext.define("Tel100.view.hr.tree.PanelViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.hrtreepanel",stores:{structure:{type:"tree",autoLoad:!1,root:{},proxy:{type:"ajax",url:"/api/hr/structure",reader:{type:"json",typeProperty:"ext_type"}},fields:[{name:"name"}]}}}),Ext.define("Tel100.view.hr.vacation.Window",{extend:"Ext.window.Window",alias:"widget.hrvacationwindow",controller:"hrvacationwindow",viewModel:{type:"hrvacationwindow"},height:340,resizable:!1,width:700,autoDestroy:!1,modal:!0,bind:{title:"{i18n.vacation.ui.button}"},items:[{xtype:"form",defaults:{labelWidth:200},bodyPadding:10,header:!1,title:"My Form",jsonSubmit:!0,url:"/api/vacation/create",items:[{xtype:"combobox",anchor:"100%",name:"vacation_type",allowBlank:!1,editable:!1,displayField:"name",valueField:"id",bind:{fieldLabel:"{i18n.vacation.fields.type}",store:"{types}"}},{xtype:"fieldcontainer",height:26,layout:{type:"hbox",align:"stretch"
},bind:{fieldLabel:"{i18n.vacation.fields.period}"},items:[{xtype:"datefield",flex:1,margin:"0 10 0 0",name:"from_date",allowBlank:!1,format:"d/m/Y"},{xtype:"datefield",flex:1,name:"to_date",allowBlank:!1,format:"d/m/Y"}]},{xtype:"label",margin:"10 0 0 0"},{xtype:"panel",padding:"0 0 10 0",header:!1,bind:{title:"{i18n.vacation.fields.signees}"}},{xtype:"fieldcontainer",height:26,layout:{type:"hbox",align:"stretch"},bind:{fieldLabel:"{i18n.vacation.fields.substitude}"},items:[{xtype:"textfield",flex:1,id:"substitude_name",name:"substitude_name",editable:!1},{xtype:"hiddenfield",flex:1,fieldLabel:"substitude",name:"substitude"},{xtype:"button",itemId:"substitude",text:"...",listeners:{click:"onSelectSubstitude"}}]},{xtype:"combobox",anchor:"100%",name:"substitude_type",readOnly:!1,editable:!1,displayField:"name",valueField:"id",bind:{fieldLabel:"{i18n.vacation.fields.docview}",store:"{substitude_type}",selection:"{substitude_explain}"}},{xtype:"textareafield",height:100,width:"100%",name:"substitude_type_explanation",submitValue:!1,editable:!1,bind:{value:"{substitude_explain.explain}"}},{xtype:"fieldcontainer",height:32,margin:"0 0 10 0",fieldLabel:"",layout:{type:"hbox",align:"stretch",pack:"end",padding:5},items:[{xtype:"button",flex:1,margin:"0 10 0 0",bind:{text:"{i18n.vacation.ui.save}"},listeners:{click:"onOKButtonClick"}},{xtype:"button",flex:1,bind:{text:"{i18n.vacation.ui.cancel}"},listeners:{click:"onCancelButtonClick"}}]},{xtype:"label",hidden:!0,padding:"10 0 0 0",bind:{text:"{i18n.vacation.fields.signees}"}},{xtype:"panel",hidden:!0,padding:"0 0 10 0",header:!1,bind:{title:"{i18n.vacation.fields.signees}"}},{xtype:"fieldcontainer",anchor:"100%",hidden:!0,layout:{type:"hbox",align:"stretch"},bind:{fieldLabel:"{i18n.vacation.fields.head_of_group}"},items:[{xtype:"textfield",flex:1,name:"head_of_group_name",editable:!1},{xtype:"hiddenfield",flex:1,fieldLabel:"Label",name:"head_of_group"},{xtype:"button",itemId:"head_of_group",text:"...",listeners:{click:"onSelectHeadOfGroupButtonClick"}}]},{xtype:"fieldcontainer",anchor:"100%",hidden:!0,layout:{type:"hbox",align:"stretch"},bind:{fieldLabel:"{i18n.vacation.fields.head_of_division}"},items:[{xtype:"textfield",flex:1,name:"head_of_division_name",editable:!1},{xtype:"hiddenfield",flex:1,fieldLabel:"Label",name:"head_of_division"},{xtype:"button",itemId:"head_of_division",text:"...",listeners:{click:"onSelectHeadOfDivisionButtonClick"}}]},{xtype:"fieldcontainer",anchor:"100%",hidden:!0,layout:{type:"hbox",align:"stretch"},bind:{fieldLabel:"{i18n.vacation.fields.head_of_department}"},items:[{xtype:"textfield",flex:1,name:"head_of_department_name",editable:!1},{xtype:"hiddenfield",flex:1,fieldLabel:"Label",name:"head_of_department"},{xtype:"button",itemId:"head_of_department",text:"...",listeners:{click:"onSelectHeadOfDepartmentClick"}}]},{xtype:"fieldcontainer",anchor:"100%",hidden:!0,layout:{type:"hbox",align:"stretch"},bind:{fieldLabel:"{i18n.vacation.fields.director}"},items:[{xtype:"textfield",flex:1,name:"director_name",editable:!1},{xtype:"hiddenfield",flex:1,fieldLabel:"Label",name:"director"},{xtype:"button",itemId:"director",text:"...",listeners:{click:"onSelectDirectorClick"}}]},{xtype:"fieldcontainer",anchor:"100%",hidden:!0,layout:{type:"hbox",align:"stretch"},bind:{fieldLabel:"{i18n.vacation.fields.head_of_hr}"},items:[{xtype:"textfield",flex:1,name:"head_of_hr_name",editable:!1},{xtype:"hiddenfield",flex:1,fieldLabel:"Label",name:"head_of_hr"},{xtype:"button",itemId:"head_of_hr",text:"...",listeners:{click:"onSelectHeadOfHRClick"}}]}]}]}),Ext.define("Tel100.view.hr.vacation.WindowViewController",{extend:"Ext.app.ViewController",alias:"controller.hrvacationwindow",chosePerson:function(e){var t={viewModel:{data:{hideHR:!1,hideParty:!0,hideCustomers:!0}}},n=helpers.party.getPartyDialog(function(t){if(t.length>0){var n=t[0];if(void 0!==n.get("id")&&"hr.Employee"==n.get("ext_type")){var o=e.up("form").getForm();o.findField(e.itemId).setValue(n.get("id")),o.findField(e.itemId+"_name").setValue(n.get("name"))}}},t);n.show()},onSelectSubstitude:function(e,t,n){this.chosePerson(e)},onOKButtonClick:function(e,t,n){var o=e.up("form").getForm();o.isValid()?o.submit({success:function(t,n){e.up("window").close()},failure:function(e,t){Ext.MessageBox.alert("Error",t.result.error)}}):Ext.Msg.alert("Invalid Data","Please correct form errors.")},onCancelButtonClick:function(e,t,n){e.up("window").close()},onSelectHeadOfGroupButtonClick:function(e,t,n){this.chosePerson(e)},onSelectHeadOfDivisionButtonClick:function(e,t,n){this.chosePerson(e)},onSelectHeadOfDepartmentClick:function(e,t,n){this.chosePerson(e)},onSelectDirectorClick:function(e,t,n){this.chosePerson(e)},onSelectHeadOfHRClick:function(e,t,n){this.chosePerson(e)}}),Ext.define("Tel100.view.hr.vacation.WindowViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.hrvacationwindow",stores:{types:{autoLoad:!0,model:"Tel100.model.hr.vacation.Type"},substitude_type:{data:[{id:"1",name:"{i18n.vacation.substitude_type.none.title}",explain:"{i18n.vacation.substitude_type.none.explain}"},{id:"2",name:"{i18n.vacation.substitude_type.all.title}",explain:"{i18n.vacation.substitude_type.all.explain}"},{id:"3",name:"{i18n.vacation.substitude_type.new.title}",explain:"{i18n.vacation.substitude_type.new.explain}"}],fields:[{name:"id"},{name:"name"},{name:"explain"}]}}}),Ext.define("Tel100.view.user.box.Button",{extend:"Ext.button.Button",alias:"widget.userboxbutton",controller:"userboxbutton",viewModel:{type:"userboxbutton"},bind:{text:'<i class="fa fa-user"></i> {currentUser.full_name}'},menu:{xtype:"menu",items:[{xtype:"menuitem",bind:{text:"{i18n.user.ui.profile}"}},{xtype:"menuseparator"},{xtype:"menuitem",bind:{text:"{i18n.user.ui.logout}"},listeners:{click:"onLogout"}}]}}),Ext.define("Tel100.view.user.box.ButtonViewController",{extend:"Ext.app.ViewController",alias:"controller.userboxbutton",onLogout:function(e,t,n){window.location.reload()}}),Ext.define("Tel100.view.user.box.ButtonViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.userboxbutton"}),Ext.define("Tel100.view.user.substitude.Panel",{extend:"Ext.panel.Panel",alias:"widget.usersubstitudepanel",controller:"usersubstitudepanel",viewModel:{type:"usersubstitudepanel"},shadow:"drop",shadowOffset:20,cls:"floating-substitude-top",floating:!0,height:26,html:"asadasdasds",width:500,layout:"border",bodyPadding:3,bodyStyle:{"background-color":"red",color:"white","text-align":"center"},header:!1,items:[{xtype:"button",region:"east",padding:0,width:20,text:"X",listeners:{click:"onButtonClick"}}]}),Ext.define("Tel100.view.user.substitude.PanelViewController",{extend:"Ext.app.ViewController",alias:"controller.usersubstitudepanel",onButtonClick:function(e,t,n){e.up("panel").destroy()}}),Ext.define("Tel100.view.user.substitude.PanelViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.usersubstitudepanel"}),Ext.define("Tel100.view.user.login.Panel",{extend:"Ext.container.Container",alias:"widget.userloginpanel",controller:"userloginpanel",viewModel:{type:"userloginpanel"},layout:{type:"hbox",align:"middle",pack:"center"},items:[{xtype:"form",flex:0,frame:!0,width:400,bodyBorder:!0,bodyPadding:10,bind:{title:"{i18n.user.ui.login_title}"},items:[{xtype:"textfield",anchor:"100%",itemId:"username",allowBlank:!1,bind:{fieldLabel:"{i18n.user.username}"}},{xtype:"textfield",anchor:"100%",itemId:"password",inputType:"password",allowBlank:!1,bind:{fieldLabel:"{i18n.user.password}"},listeners:{specialkey:"onPasswordSpecialkey"}},{xtype:"container",layout:{type:"hbox",align:"stretch",pack:"end"},items:[{xtype:"button",formBind:!0,bind:{text:"{i18n.user.ui.login}"},listeners:{click:"onLoginClick"}}]}]}],listeners:{afterrender:"onAfterRender"}}),Ext.define("Tel100.view.user.login.PanelViewController",{extend:"Ext.app.ViewController",alias:"controller.userloginpanel",onLogin:function(){var e=this,t=e.getView(),n=t.down("#username"),o=t.down("#password"),i=n.value,d=o.value;i&&d&&helpers.ajax.request({url:"/api/user/login",method:"POST",view:t,params:{userID:i,password:d,api_locale:helpers.i18n.getCurrentLocale()},success:function(e){var n=new Tel100.model.User(e.user);helpers.user.setCurrentUser(n,d),t.fireEvent("loggedin",n)}})},onPasswordSpecialkey:function(e,t,n){t.getKey()===Ext.EventObject.ENTER&&this.onLogin()},onLoginClick:function(e,t,n){this.onLogin()},onAfterRender:function(e,t){var n=e.down("#username"),o=e.down("#password"),i=helpers.preferences.getValue("username");i?(n.setValue(i),o.focus()):n.focus()}}),Ext.define("Tel100.view.user.login.PanelViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.userloginpanel"}),Ext.define("Tel100.view.admin.types.grid.Panel",{extend:"Ext.grid.Panel",alias:"widget.admintypesgridpanel",controller:"admintypesgridpanel",viewModel:{type:"admintypesgridpanel"},width:300,bind:{title:"{i18n.document.type.ui.types}",store:"{types}"},columns:[{xtype:"gridcolumn",width:50,dataIndex:"order_by",bind:{text:"{i18n.document.type.order_by}"}},{xtype:"gridcolumn",dataIndex:"name",flex:1,bind:{text:"{i18n.document.type.name}"}}],tools:[{xtype:"tool",type:"refresh",listeners:{click:"onRefresh"}}],refresh:function(e){this.getStore("types").load()}}),Ext.define("Tel100.view.admin.types.grid.PanelViewController",{extend:"Ext.app.ViewController",alias:"controller.admintypesgridpanel",onRefresh:function(e,t,n,o){this.getView().refresh()},onBeforeLoad:function(e,t,n){this.getView().setLoading(!0)},onLoad:function(e,t,n,o){this.getView().setLoading(!1)}}),Ext.define("Tel100.view.admin.types.grid.PanelViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.admintypesgridpanel",stores:{types:{autoLoad:!0,model:"Tel100.model.document.Type",listeners:{beforeload:"onBeforeLoad",load:"onLoad"}}}});